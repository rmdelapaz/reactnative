<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn end-to-end testing for React Native apps with Maestro">
    <meta name="author" content="React Native & Expo Course">
    <title>E2E Testing with Maestro | Module 9: Testing and Quality Assurance | React Native & Expo Course</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-main">Skip to main content</a>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="nav-logo">üì± RN Course</a>
            <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-expanded="false" aria-controls="nav-links">
                ‚ò∞
            </button>
            <div class="nav-links" id="nav-links">
                <a href="index.html">Home</a>
                <a href="index.html#modules">Modules</a>
                <a href="index.html#appendices">Appendices</a>
                <button id="theme-toggle" aria-label="Toggle theme">üåô</button>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <a href="index.html">Home</a> &gt;
            <a href="index.html#modules">Modules</a> &gt;
            <a href="m09_l01_testing_fundamentals.html">Module 9</a> &gt;
            <span>Lesson 9.5</span>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">
        <div class="container">
            <!-- Lesson Header -->
            <header>
                <p class="module-tag">Module 9: Testing and Quality Assurance</p>
                <h1>E2E Testing with Maestro</h1>
                <p class="lesson-subtitle">Automated UI testing on real devices and simulators</p>
            </header>

            <!-- Learning Objectives -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="color: white; border: none; margin-top: 0;">üéØ Learning Objectives</h2>
                <ul style="color: white;">
                    <li>Understand what E2E testing is and when to use it</li>
                    <li>Set up Maestro for React Native/Expo projects</li>
                    <li>Write Maestro flow files in YAML</li>
                    <li>Use selectors to find and interact with elements</li>
                    <li>Handle assertions and conditional logic</li>
                    <li>Test complex user flows and edge cases</li>
                    <li>Integrate E2E tests into CI/CD pipelines</li>
                </ul>
            </div>

            <!-- Table of Contents -->
            <div class="toc-container">
                <details class="toc-details" open>
                    <summary>üìë Table of Contents</summary>
                    <ul class="toc-list">
                        <li><a href="#e2e-overview">E2E Testing Overview</a></li>
                        <li><a href="#maestro-setup">Maestro Setup</a></li>
                        <li><a href="#writing-flows">Writing Flows</a></li>
                        <li><a href="#selectors">Selectors and Elements</a></li>
                        <li><a href="#interactions">Interactions</a></li>
                        <li><a href="#assertions">Assertions</a></li>
                        <li><a href="#advanced">Advanced Features</a></li>
                        <li><a href="#ci-cd">CI/CD Integration</a></li>
                        <li><a href="#exercises">Hands-On Exercises</a></li>
                        <li><a href="#summary">Summary</a></li>
                    </ul>
                </details>
            </div>

            <!-- E2E Testing Overview -->
            <section id="e2e-overview">
                <h2>E2E Testing Overview</h2>

                <p>End-to-end (E2E) tests verify your entire application works correctly from the user's perspective, testing real interactions on actual devices or simulators.</p>

                <h3>What is E2E Testing?</h3>

                <!-- SVG: E2E Testing Flow -->
                <div class="svg-container" style="text-align: center; margin: 2rem 0;">
                    <svg viewBox="0 0 700 200" style="max-width: 700px; height: auto; font-family: system-ui, sans-serif;">
                        <!-- Background -->
                        <rect width="700" height="200" fill="#f8f9fa"/>
                        
                        <!-- User -->
                        <g transform="translate(50, 60)">
                            <circle cx="30" cy="20" r="20" fill="#667eea"/>
                            <rect x="10" y="45" width="40" height="50" rx="5" fill="#667eea"/>
                            <text x="30" y="120" text-anchor="middle" font-size="11" fill="#333">User</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 110 90 L 150 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- App UI -->
                        <g transform="translate(160, 40)">
                            <rect width="100" height="120" fill="#4CAF50" rx="10"/>
                            <rect x="10" y="10" width="80" height="15" fill="white" rx="3"/>
                            <rect x="10" y="35" width="80" height="40" fill="rgba(255,255,255,0.5)" rx="3"/>
                            <rect x="10" y="85" width="80" height="25" fill="white" rx="3"/>
                            <text x="50" y="175" text-anchor="middle" font-size="11" fill="#333">App UI</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 270 90 L 310 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Business Logic -->
                        <g transform="translate(320, 50)">
                            <rect width="100" height="100" fill="#2196F3" rx="10"/>
                            <text x="50" y="40" text-anchor="middle" font-size="10" fill="white">Business</text>
                            <text x="50" y="55" text-anchor="middle" font-size="10" fill="white">Logic</text>
                            <rect x="15" y="65" width="70" height="25" fill="rgba(255,255,255,0.3)" rx="3"/>
                            <text x="50" y="165" text-anchor="middle" font-size="11" fill="#333">Logic</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 430 90 L 470 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- API/Backend -->
                        <g transform="translate(480, 50)">
                            <rect width="100" height="100" fill="#FF9800" rx="10"/>
                            <text x="50" y="40" text-anchor="middle" font-size="10" fill="white">API /</text>
                            <text x="50" y="55" text-anchor="middle" font-size="10" fill="white">Backend</text>
                            <circle cx="50" cy="75" r="15" fill="rgba(255,255,255,0.3)"/>
                            <text x="50" y="165" text-anchor="middle" font-size="11" fill="#333">Backend</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 590 90 L 630 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Database -->
                        <g transform="translate(640, 55)">
                            <ellipse cx="25" cy="10" rx="25" ry="10" fill="#9C27B0"/>
                            <rect x="0" y="10" width="50" height="60" fill="#9C27B0"/>
                            <ellipse cx="25" cy="70" rx="25" ry="10" fill="#7B1FA2"/>
                            <text x="25" y="140" text-anchor="middle" font-size="11" fill="#333">DB</text>
                        </g>
                        
                        <!-- E2E Test bracket -->
                        <path d="M 40 180 L 40 175 L 680 175 L 680 180" stroke="#e91e63" stroke-width="2" fill="none"/>
                        <text x="360" y="195" text-anchor="middle" font-size="12" font-weight="bold" fill="#e91e63">E2E Test Coverage</text>
                        
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                            </marker>
                        </defs>
                    </svg>
                </div>

                <h3>When to Use E2E Tests</h3>

                <div class="card">
                    <h4>‚úÖ Use E2E Tests For</h4>
                    <ul>
                        <li><strong>Critical user flows:</strong> Login, checkout, onboarding</li>
                        <li><strong>Cross-feature interactions:</strong> Flows spanning multiple screens</li>
                        <li><strong>Regression testing:</strong> Ensure existing features still work</li>
                        <li><strong>Real device testing:</strong> Platform-specific behaviors</li>
                        <li><strong>Visual validation:</strong> Screenshots and visual comparisons</li>
                    </ul>
                    
                    <h4 style="margin-top: 16px;">‚ùå Avoid E2E Tests For</h4>
                    <ul>
                        <li>Testing implementation details</li>
                        <li>Exhaustive edge case coverage</li>
                        <li>Rapid iteration during development</li>
                        <li>Testing isolated components</li>
                    </ul>
                </div>

                <h3>Why Maestro?</h3>

                <p>Maestro is a mobile UI testing framework that offers several advantages:</p>

                <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Feature</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Benefit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">YAML-based flows</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Easy to write and maintain, no programming required</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Built-in tolerance</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Automatic retries and waiting for elements</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Cross-platform</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Same flows work on iOS and Android</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Maestro Studio</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Visual tool for discovering selectors</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Cloud support</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Run tests on Maestro Cloud in CI/CD</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Maestro Setup -->
            <section id="maestro-setup">
                <h2>Maestro Setup</h2>

                <h3>Installation</h3>

                <pre><code># macOS
curl -Ls "https://get.maestro.mobile.dev" | bash

# Windows (WSL2)
curl -Ls "https://get.maestro.mobile.dev" | bash

# Verify installation
maestro --version</code></pre>

                <h3>Project Setup</h3>

                <pre><code># Create maestro directory in your project
mkdir -p .maestro

# Project structure
your-app/
‚îú‚îÄ‚îÄ .maestro/
‚îÇ   ‚îú‚îÄ‚îÄ flows/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkout.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ onboarding.yaml
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ src/
‚îî‚îÄ‚îÄ package.json</code></pre>

                <h3>Adding testID to Components</h3>

                <p>For reliable element selection, add testID props to your components:</p>

                <pre><code>// Add testID to interactive elements
&lt;Pressable testID="login-button" onPress={handleLogin}&gt;
  &lt;Text&gt;Login&lt;/Text&gt;
&lt;/Pressable&gt;

&lt;TextInput
  testID="email-input"
  placeholder="Email"
  value={email}
  onChangeText={setEmail}
/&gt;

&lt;TextInput
  testID="password-input"
  placeholder="Password"
  secureTextEntry
  value={password}
  onChangeText={setPassword}
/&gt;

// Use consistent naming conventions
// Format: [component]-[action/type]
// Examples: login-button, email-input, user-avatar, cart-badge</code></pre>

                <h3>Running Your First Test</h3>

                <pre><code># Build and run your app
npx expo start

# In a separate terminal, run Maestro Studio to explore your app
maestro studio

# Run a specific flow
maestro test .maestro/flows/login.yaml

# Run all flows
maestro test .maestro/flows/</code></pre>
            </section>

            <!-- Writing Flows -->
            <section id="writing-flows">
                <h2>Writing Flows</h2>

                <p>Maestro flows are written in YAML, describing user actions step by step.</p>

                <h3>Basic Flow Structure</h3>

                <pre><code># .maestro/flows/login.yaml
appId: com.yourcompany.yourapp  # Your app's bundle ID
---
# Flow steps
- launchApp

- tapOn:
    id: "email-input"

- inputText: "test@example.com"

- tapOn:
    id: "password-input"

- inputText: "password123"

- tapOn:
    id: "login-button"

- assertVisible:
    text: "Welcome"</code></pre>

                <h3>Flow Configuration</h3>

                <pre><code># .maestro/config.yaml
# Global configuration
flows:
  - flows/*.yaml

# Environment variables
env:
  TEST_EMAIL: "test@example.com"
  TEST_PASSWORD: "password123"
  API_URL: "https://api.staging.example.com"

# Execution settings
executionOrder:
  continueOnFailure: false
  flowsOrder:
    - flows/login.yaml
    - flows/home.yaml
    - flows/checkout.yaml</code></pre>

                <h3>Using Environment Variables</h3>

                <pre><code># .maestro/flows/login.yaml
appId: com.yourcompany.yourapp
---
- launchApp

- tapOn:
    id: "email-input"
- inputText: "${TEST_EMAIL}"

- tapOn:
    id: "password-input"  
- inputText: "${TEST_PASSWORD}"

- tapOn:
    id: "login-button"</code></pre>

                <pre><code># Run with custom env vars
maestro test --env TEST_EMAIL=custom@test.com .maestro/flows/login.yaml</code></pre>

                <h3>Flow with Comments</h3>

                <pre><code># .maestro/flows/checkout.yaml
appId: com.yourcompany.yourapp
name: "Checkout Flow"
tags:
  - critical
  - checkout
---
# Step 1: Start from home and add item to cart
- launchApp
- tapOn:
    id: "product-1"
- tapOn:
    id: "add-to-cart-button"

# Step 2: Go to cart
- tapOn:
    id: "cart-tab"
- assertVisible:
    id: "cart-item-1"

# Step 3: Proceed to checkout
- tapOn:
    id: "checkout-button"

# Step 4: Fill shipping info
- tapOn:
    id: "address-input"
- inputText: "123 Main Street"

# Step 5: Complete order
- tapOn:
    id: "place-order-button"

# Step 6: Verify success
- assertVisible:
    text: "Order Confirmed"</code></pre>
            </section>

            <!-- Selectors and Elements -->
            <section id="selectors">
                <h2>Selectors and Elements</h2>

                <p>Maestro provides multiple ways to find elements on screen.</p>

                <h3>Selector Types</h3>

                <pre><code># By testID (most reliable)
- tapOn:
    id: "login-button"

# By text content
- tapOn:
    text: "Login"

# By partial text (contains)
- tapOn:
    text: "Log.*"  # Regex pattern

# By accessibility label
- tapOn:
    accessibilityLabel: "Login button"

# Combining selectors
- tapOn:
    id: "submit-button"
    text: "Submit"  # Must match both</code></pre>

                <h3>Element Index</h3>

                <pre><code># When multiple elements match, use index
- tapOn:
    text: "Add"
    index: 0  # First "Add" button

- tapOn:
    text: "Add"
    index: 1  # Second "Add" button

# Or use more specific selectors
- tapOn:
    id: "add-button-product-1"</code></pre>

                <h3>Relative Selectors</h3>

                <pre><code># Find element relative to another
- tapOn:
    below:
      text: "Email"
    id: "text-input"

- tapOn:
    above:
      id: "footer"
    text: "Submit"

# Contained within
- tapOn:
    text: "Delete"
    containedIn:
      id: "cart-item-1"</code></pre>

                <h3>Using Maestro Studio</h3>

                <pre><code># Launch Maestro Studio to discover selectors
maestro studio

# Studio features:
# - Live view of your app
# - Click elements to see available selectors
# - Test commands interactively
# - Generate YAML snippets
# - View element hierarchy</code></pre>

                <div class="card" style="background: #e3f2fd; border-left: 4px solid #2196F3;">
                    <h4>üí° Selector Best Practices</h4>
                    <ul>
                        <li><strong>Prefer testID:</strong> Most stable, won't change with text/layout changes</li>
                        <li><strong>Use meaningful IDs:</strong> <code>submit-order-button</code> not <code>btn1</code></li>
                        <li><strong>Avoid index when possible:</strong> Tests break when order changes</li>
                        <li><strong>Fallback to text:</strong> When testID isn't available</li>
                    </ul>
                </div>
            </section>

            <!-- Interactions -->
            <section id="interactions">
                <h2>Interactions</h2>

                <p>Maestro supports various user interactions for comprehensive testing.</p>

                <h3>Tap Actions</h3>

                <pre><code># Simple tap
- tapOn:
    id: "button"

# Tap at coordinates (use sparingly)
- tapOn:
    point: "50%,50%"  # Center of screen

# Long press
- longPressOn:
    id: "list-item"

# Double tap
- doubleTapOn:
    id: "image"</code></pre>

                <h3>Text Input</h3>

                <pre><code># Type text into focused field
- inputText: "Hello World"

# Clear and type
- tapOn:
    id: "search-input"
- eraseText: 20  # Erase up to 20 characters
- inputText: "New search"

# Type with special keys
- inputText: "username"
- pressKey: Tab
- inputText: "password"
- pressKey: Enter

# Hide keyboard
- hideKeyboard</code></pre>

                <h3>Gestures</h3>

                <pre><code># Scroll
- scroll  # Default scroll down

- scrollUntilVisible:
    element:
      text: "Load More"
    direction: DOWN
    timeout: 10000

# Swipe
- swipe:
    direction: LEFT
    
- swipe:
    start: "90%,50%"
    end: "10%,50%"

# Pull to refresh
- scroll:
    direction: DOWN
    duration: 1000</code></pre>

                <h3>Navigation</h3>

                <pre><code># Go back (Android back button / iOS swipe)
- back

# Open URL / Deep link
- openLink: "yourapp://products/123"

# Launch app
- launchApp

# Launch with clear state
- launchApp:
    clearState: true

# Stop app
- stopApp

# Kill and relaunch
- stopApp
- launchApp</code></pre>

                <h3>Waiting</h3>

                <pre><code># Explicit wait
- waitForAnimationToEnd

# Wait for element with timeout
- assertVisible:
    id: "loading-complete"
    timeout: 10000  # 10 seconds

# Wait for element to disappear
- assertNotVisible:
    id: "loading-spinner"
    timeout: 5000

# Custom delay (use sparingly)
- wait: 2000  # 2 seconds</code></pre>
            </section>

            <!-- Assertions -->
            <section id="assertions">
                <h2>Assertions</h2>

                <p>Assertions verify that your app is in the expected state.</p>

                <h3>Visibility Assertions</h3>

                <pre><code># Element is visible
- assertVisible:
    id: "welcome-message"

- assertVisible:
    text: "Login successful"

# Element is NOT visible
- assertNotVisible:
    id: "error-message"

- assertNotVisible:
    text: "Error"

# With timeout
- assertVisible:
    id: "data-loaded"
    timeout: 15000</code></pre>

                <h3>Content Assertions</h3>

                <pre><code># Check text content
- assertVisible:
    text: "Hello, John"

# Regex matching
- assertVisible:
    text: "Order #[0-9]+"

# Check element contains text
- assertVisible:
    id: "price-display"
    text: "$99.99"</code></pre>

                <h3>State Assertions</h3>

                <pre><code># Check element is enabled
- assertVisible:
    id: "submit-button"
    enabled: true

# Check element is focused
- assertVisible:
    id: "email-input"
    focused: true

# Check checkbox/toggle state
- assertVisible:
    id: "terms-checkbox"
    checked: true</code></pre>

                <h3>Screenshot Assertions</h3>

                <pre><code># Take screenshot
- takeScreenshot: "checkout-complete"

# Screenshots saved to:
# ~/.maestro/tests/[timestamp]/screenshots/</code></pre>

                <h3>Conditional Logic</h3>

                <pre><code># Run steps only if element visible
- runFlow:
    when:
      visible:
        id: "onboarding-modal"
    commands:
      - tapOn:
          id: "skip-button"

# If-else pattern
- runFlow:
    when:
      visible:
        text: "Login"
    commands:
      - tapOn:
          id: "login-button"
      # ... login steps

- runFlow:
    when:
      notVisible:
        text: "Login"
    commands:
      # Already logged in, continue
      - assertVisible:
          id: "home-screen"</code></pre>
            </section>

            <!-- Advanced Features -->
            <section id="advanced">
                <h2>Advanced Features</h2>

                <h3>Subflows</h3>

                <pre><code># .maestro/flows/shared/login.yaml
appId: com.yourcompany.yourapp
---
- tapOn:
    id: "email-input"
- inputText: "${EMAIL}"

- tapOn:
    id: "password-input"
- inputText: "${PASSWORD}"

- tapOn:
    id: "login-button"

- assertVisible:
    id: "home-screen"

# .maestro/flows/purchase.yaml
appId: com.yourcompany.yourapp
env:
  EMAIL: "test@example.com"
  PASSWORD: "password123"
---
- launchApp:
    clearState: true

# Include login flow
- runFlow: shared/login.yaml

# Continue with purchase
- tapOn:
    id: "product-1"
- tapOn:
    id: "buy-now"</code></pre>

                <h3>Loops and Repeating</h3>

                <pre><code># Repeat action multiple times
- repeat:
    times: 3
    commands:
      - tapOn:
          id: "increment-button"

# Repeat until condition
- repeat:
    whileVisible:
      text: "Load More"
    commands:
      - tapOn:
          text: "Load More"
      - scroll

# Repeat with variable
- repeat:
    times: ${ITEM_COUNT}
    commands:
      - tapOn:
          text: "Add to Cart"
      - back</code></pre>

                <h3>External Scripts</h3>

                <pre><code># Run JavaScript for complex logic
- runScript:
    file: scripts/generate-data.js
    env:
      OUTPUT_VAR: generatedEmail

- tapOn:
    id: "email-input"
- inputText: "${generatedEmail}"

# scripts/generate-data.js
const timestamp = Date.now();
output.generatedEmail = `test-${timestamp}@example.com`;</code></pre>

                <h3>API Requests</h3>

                <pre><code># Make HTTP request during test
- evalScript: |
    const response = await http.get('https://api.example.com/test-token');
    output.token = response.body.token;

- tapOn:
    id: "token-input"
- inputText: "${token}"

# POST request
- evalScript: |
    const response = await http.post('https://api.example.com/reset', {
      body: JSON.stringify({ email: '${TEST_EMAIL}' }),
      headers: { 'Content-Type': 'application/json' }
    });
    output.resetCode = response.body.code;</code></pre>

                <h3>Handling Alerts and Permissions</h3>

                <pre><code># Handle system dialogs
- tapOn:
    text: "Allow"  # Permission dialog

# Dismiss alert
- tapOn:
    text: "OK"

# Handle specific iOS permissions
- tapOn:
    text: "Allow While Using App"

# On Android
- tapOn:
    text: "ALLOW"

# Conditional handling
- runFlow:
    when:
      visible:
        text: "Allow.*access"
    commands:
      - tapOn:
          text: "Allow"</code></pre>
            </section>
            <!-- CI/CD Integration -->
            <section id="ci-cd">
                <h2>CI/CD Integration</h2>

                <p>Run E2E tests automatically in your continuous integration pipeline.</p>

                <h3>GitHub Actions Setup</h3>

                <pre><code># .github/workflows/e2e-tests.yml
name: E2E Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  e2e-ios:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Install Maestro
        run: |
          curl -Ls "https://get.maestro.mobile.dev" | bash
          echo "$HOME/.maestro/bin" >> $GITHUB_PATH
      
      - name: Build iOS app
        run: |
          npx expo prebuild --platform ios
          xcodebuild -workspace ios/YourApp.xcworkspace \
            -scheme YourApp \
            -configuration Debug \
            -destination 'platform=iOS Simulator,name=iPhone 15' \
            -derivedDataPath build
      
      - name: Boot iOS Simulator
        run: |
          xcrun simctl boot "iPhone 15"
      
      - name: Install app on Simulator
        run: |
          xcrun simctl install booted build/Build/Products/Debug-iphonesimulator/YourApp.app
      
      - name: Run Maestro Tests
        run: |
          maestro test .maestro/flows/ --format junit --output test-results.xml
      
      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: e2e-test-results
          path: test-results.xml

  e2e-android:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
      
      - name: Install Maestro
        run: |
          curl -Ls "https://get.maestro.mobile.dev" | bash
          echo "$HOME/.maestro/bin" >> $GITHUB_PATH
      
      - name: Build Android app
        run: |
          npx expo prebuild --platform android
          cd android && ./gradlew assembleDebug
      
      - name: Enable KVM
        run: |
          echo 'KERNEL=="kvm", GROUP="kvm", MODE="0666", OPTIONS+="static_node=kvm"' | sudo tee /etc/udev/rules.d/99-kvm4all.rules
          sudo udevadm control --reload-rules
          sudo udevadm trigger --name-match=kvm
      
      - name: Run E2E Tests
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 34
          arch: x86_64
          script: |
            adb install android/app/build/outputs/apk/debug/app-debug.apk
            maestro test .maestro/flows/ --format junit --output test-results.xml
      
      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: e2e-test-results-android
          path: test-results.xml</code></pre>

                <h3>Maestro Cloud</h3>

                <pre><code># Upload to Maestro Cloud for managed execution
maestro cloud --apiKey $MAESTRO_API_KEY .maestro/flows/

# With app binary
maestro cloud --apiKey $MAESTRO_API_KEY \
  --app-file android/app/build/outputs/apk/debug/app-debug.apk \
  .maestro/flows/

# In CI
- name: Run on Maestro Cloud
  env:
    MAESTRO_API_KEY: ${{ secrets.MAESTRO_API_KEY }}
  run: |
    maestro cloud \
      --apiKey $MAESTRO_API_KEY \
      --app-file app-release.apk \
      --android-api-level 34 \
      .maestro/flows/</code></pre>

                <h3>Test Reporting</h3>

                <pre><code># Generate JUnit report
maestro test .maestro/flows/ --format junit --output results.xml

# Generate HTML report
maestro test .maestro/flows/ --format html --output report.html

# Include screenshots on failure
maestro test .maestro/flows/ --include-tags critical --debug-output ./debug</code></pre>

                <h3>Running Tests by Tags</h3>

                <pre><code># Tag your flows
# .maestro/flows/checkout.yaml
appId: com.yourcompany.yourapp
tags:
  - critical
  - checkout
  - smoke
---
# ... flow steps

# Run only specific tags
maestro test .maestro/flows/ --include-tags critical
maestro test .maestro/flows/ --include-tags smoke
maestro test .maestro/flows/ --exclude-tags slow</code></pre>

                <h3>Parallel Execution</h3>

                <pre><code># Run tests in parallel (requires multiple devices/emulators)
maestro test .maestro/flows/ --shards 4

# In CI with matrix strategy
jobs:
  e2e:
    strategy:
      matrix:
        shard: [1, 2, 3, 4]
    steps:
      - name: Run Maestro Shard
        run: |
          maestro test .maestro/flows/ \
            --shard ${{ matrix.shard }}/4</code></pre>
            </section>

            <!-- Hands-On Exercises -->
            <section id="exercises">
                <h2>Hands-On Exercises</h2>

                <div class="exercise-card">
                    <h3>Exercise 1: Login Flow</h3>
                    <p>Write a complete login flow test with error handling.</p>
                    
                    <h4>Requirements:</h4>
                    <ul>
                        <li>Test successful login</li>
                        <li>Test login with invalid credentials</li>
                        <li>Verify error message is shown</li>
                        <li>Test password visibility toggle</li>
                    </ul>

                    <details>
                        <summary>Show Solution</summary>
                        <pre><code># .maestro/flows/auth/login-success.yaml
appId: com.yourcompany.yourapp
name: "Login - Success"
tags:
  - auth
  - smoke
  - critical
env:
  VALID_EMAIL: "test@example.com"
  VALID_PASSWORD: "password123"
---
- launchApp:
    clearState: true

# Navigate to login if needed
- runFlow:
    when:
      visible:
        text: "Get Started"
    commands:
      - tapOn:
          text: "Get Started"
      - tapOn:
          text: "Login"

# Enter credentials
- tapOn:
    id: "email-input"
- inputText: "${VALID_EMAIL}"

- tapOn:
    id: "password-input"
- inputText: "${VALID_PASSWORD}"

# Submit
- tapOn:
    id: "login-button"

# Verify success
- assertVisible:
    id: "home-screen"
    timeout: 10000

- assertVisible:
    text: "Welcome"

# .maestro/flows/auth/login-invalid.yaml
appId: com.yourcompany.yourapp
name: "Login - Invalid Credentials"
tags:
  - auth
---
- launchApp:
    clearState: true

- tapOn:
    id: "email-input"
- inputText: "wrong@example.com"

- tapOn:
    id: "password-input"
- inputText: "wrongpassword"

- tapOn:
    id: "login-button"

# Verify error
- assertVisible:
    text: "Invalid credentials"
    timeout: 5000

# Still on login screen
- assertVisible:
    id: "login-button"

# .maestro/flows/auth/password-toggle.yaml
appId: com.yourcompany.yourapp
name: "Login - Password Visibility"
tags:
  - auth
---
- launchApp:
    clearState: true

- tapOn:
    id: "password-input"
- inputText: "mypassword"

# Password should be hidden by default
- assertVisible:
    id: "password-toggle"

# Toggle visibility
- tapOn:
    id: "password-toggle"

# Take screenshot to verify (manual check)
- takeScreenshot: "password-visible"

# Toggle back
- tapOn:
    id: "password-toggle"

- takeScreenshot: "password-hidden"</code></pre>
                    </details>
                </div>

                <div class="exercise-card">
                    <h3>Exercise 2: Shopping Cart Flow</h3>
                    <p>Test adding items to cart and completing checkout.</p>
                    
                    <h4>Requirements:</h4>
                    <ul>
                        <li>Add multiple items to cart</li>
                        <li>Verify cart count updates</li>
                        <li>Modify quantities in cart</li>
                        <li>Complete checkout process</li>
                        <li>Verify order confirmation</li>
                    </ul>

                    <details>
                        <summary>Show Solution</summary>
                        <pre><code># .maestro/flows/shopping/add-to-cart.yaml
appId: com.yourcompany.yourapp
name: "Shopping - Add to Cart"
tags:
  - shopping
  - critical
---
- launchApp:
    clearState: true

# Login first (reuse subflow)
- runFlow: ../auth/login-success.yaml

# Browse products
- tapOn:
    id: "shop-tab"

# Add first product
- tapOn:
    id: "product-card-1"
- assertVisible:
    id: "product-details"
- tapOn:
    id: "add-to-cart-button"

# Verify cart badge
- assertVisible:
    id: "cart-badge"
    text: "1"

# Go back and add another
- back
- tapOn:
    id: "product-card-2"
- tapOn:
    id: "add-to-cart-button"

# Cart should show 2
- assertVisible:
    id: "cart-badge"
    text: "2"

# .maestro/flows/shopping/checkout.yaml
appId: com.yourcompany.yourapp
name: "Shopping - Checkout"
tags:
  - shopping
  - checkout
  - critical
---
# Start with items in cart
- runFlow: add-to-cart.yaml

# Go to cart
- tapOn:
    id: "cart-tab"

# Verify items
- assertVisible:
    id: "cart-item-1"
- assertVisible:
    id: "cart-item-2"

# Increase quantity
- tapOn:
    id: "increase-qty-1"
- assertVisible:
    id: "qty-1"
    text: "2"

# Proceed to checkout
- tapOn:
    id: "checkout-button"

# Fill shipping
- tapOn:
    id: "name-input"
- inputText: "John Doe"

- tapOn:
    id: "address-input"
- inputText: "123 Main Street"

- tapOn:
    id: "city-input"
- inputText: "New York"

- scroll

- tapOn:
    id: "zip-input"
- inputText: "10001"

- hideKeyboard

# Continue to payment
- tapOn:
    id: "continue-button"

# Fill payment (test card)
- tapOn:
    id: "card-number"
- inputText: "4111111111111111"

- tapOn:
    id: "expiry"
- inputText: "12/28"

- tapOn:
    id: "cvv"
- inputText: "123"

- hideKeyboard

# Place order
- tapOn:
    id: "place-order-button"

# Verify confirmation
- assertVisible:
    text: "Order Confirmed"
    timeout: 15000

- assertVisible:
    text: "Order #"

- takeScreenshot: "order-confirmation"</code></pre>
                    </details>
                </div>

                <div class="exercise-card">
                    <h3>Exercise 3: Onboarding Flow with Skip Option</h3>
                    <p>Test the onboarding experience with multiple paths.</p>
                    
                    <h4>Requirements:</h4>
                    <ul>
                        <li>Test completing all onboarding steps</li>
                        <li>Test skipping onboarding</li>
                        <li>Verify final state is correct for both paths</li>
                        <li>Handle permission dialogs</li>
                    </ul>

                    <details>
                        <summary>Show Solution</summary>
                        <pre><code># .maestro/flows/onboarding/complete-onboarding.yaml
appId: com.yourcompany.yourapp
name: "Onboarding - Complete All Steps"
tags:
  - onboarding
---
- launchApp:
    clearState: true

# Step 1: Welcome
- assertVisible:
    text: "Welcome to Our App"
- tapOn:
    id: "next-button"

# Step 2: Features
- assertVisible:
    text: "Discover Features"
- swipe:
    direction: LEFT
# Or tap next
- tapOn:
    id: "next-button"

# Step 3: Notifications permission
- assertVisible:
    text: "Stay Updated"
- tapOn:
    id: "enable-notifications"

# Handle system permission dialog
- runFlow:
    when:
      visible:
        text: "Allow"
    commands:
      - tapOn:
          text: "Allow"

- tapOn:
    id: "next-button"

# Step 4: Location permission
- assertVisible:
    text: "Find Nearby"
- tapOn:
    id: "enable-location"

- runFlow:
    when:
      visible:
        text: "Allow While Using"
    commands:
      - tapOn:
          text: "Allow While Using"

- tapOn:
    id: "next-button"

# Step 5: Complete
- assertVisible:
    text: "You're All Set!"
- tapOn:
    id: "get-started-button"

# Verify on home screen
- assertVisible:
    id: "home-screen"

# .maestro/flows/onboarding/skip-onboarding.yaml
appId: com.yourcompany.yourapp
name: "Onboarding - Skip"
tags:
  - onboarding
---
- launchApp:
    clearState: true

# Welcome screen - tap skip
- assertVisible:
    text: "Welcome to Our App"
- tapOn:
    id: "skip-button"

# Confirm skip dialog
- runFlow:
    when:
      visible:
        text: "Are you sure"
    commands:
      - tapOn:
          text: "Yes, Skip"

# Should be on home screen
- assertVisible:
    id: "home-screen"
    timeout: 5000

# Verify basic functionality works
- tapOn:
    id: "explore-tab"
- assertVisible:
    id: "explore-screen"

# .maestro/flows/onboarding/resume-onboarding.yaml
appId: com.yourcompany.yourapp
name: "Onboarding - Resume After Close"
tags:
  - onboarding
---
- launchApp:
    clearState: true

# Start onboarding
- assertVisible:
    text: "Welcome to Our App"
- tapOn:
    id: "next-button"

# On step 2, close app
- assertVisible:
    text: "Discover Features"
- stopApp

# Relaunch
- launchApp

# Should resume at step 2
- assertVisible:
    text: "Discover Features"</code></pre>
                    </details>
                </div>
            </section>

            <!-- Summary -->
            <section id="summary">
                <h2>Summary</h2>

                <p>E2E testing with Maestro validates your entire app from the user's perspective, catching issues that unit and integration tests might miss.</p>

                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h4 style="color: white;">üéØ Key Takeaways</h4>
                    <ul style="color: white;">
                        <li><strong>E2E purpose:</strong> Test critical user flows on real devices/simulators</li>
                        <li><strong>Maestro flows:</strong> Write tests in readable YAML format</li>
                        <li><strong>testID props:</strong> Add to components for reliable selection</li>
                        <li><strong>Maestro Studio:</strong> Use for discovering selectors interactively</li>
                        <li><strong>Selectors:</strong> Prefer testID, fallback to text/accessibility</li>
                        <li><strong>Subflows:</strong> Reuse common sequences like login</li>
                        <li><strong>CI/CD:</strong> Integrate with GitHub Actions or Maestro Cloud</li>
                        <li><strong>Tags:</strong> Organize tests for targeted execution</li>
                        <li><strong>Balance:</strong> Focus on critical paths, not exhaustive coverage</li>
                    </ul>
                </div>

                <h3>Testing Strategy Complete</h3>

                <p>With Module 9 complete, you now have a comprehensive testing strategy:</p>

                <!-- SVG: Testing Strategy Summary -->
                <div class="svg-container" style="text-align: center; margin: 2rem 0;">
                    <svg viewBox="0 0 600 300" style="max-width: 600px; height: auto; font-family: system-ui, sans-serif;">
                        <!-- Background -->
                        <rect width="600" height="300" fill="#f8f9fa"/>
                        
                        <!-- Pyramid -->
                        <polygon points="300,30 520,250 80,250" fill="#e0e0e0" stroke="#999" stroke-width="2"/>
                        
                        <!-- E2E Section -->
                        <polygon points="300,30 380,110 220,110" fill="#FF9800"/>
                        <text x="300" y="80" text-anchor="middle" font-size="12" font-weight="bold" fill="white">E2E</text>
                        <text x="300" y="95" text-anchor="middle" font-size="9" fill="white">~10%</text>
                        
                        <!-- Integration Section -->
                        <polygon points="220,110 380,110 440,180 160,180" fill="#2196F3"/>
                        <text x="300" y="145" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Integration</text>
                        <text x="300" y="162" text-anchor="middle" font-size="9" fill="white">~20%</text>
                        
                        <!-- Unit Section -->
                        <polygon points="160,180 440,180 520,250 80,250" fill="#4CAF50"/>
                        <text x="300" y="215" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Unit Tests</text>
                        <text x="300" y="235" text-anchor="middle" font-size="9" fill="white">~70%</text>
                        
                        <!-- Labels -->
                        <g transform="translate(540, 60)">
                            <rect width="15" height="15" fill="#FF9800"/>
                            <text x="22" y="12" font-size="10" fill="#333">Maestro</text>
                        </g>
                        <g transform="translate(540, 85)">
                            <rect width="15" height="15" fill="#2196F3"/>
                            <text x="22" y="12" font-size="10" fill="#333">RTL + Mocks</text>
                        </g>
                        <g transform="translate(540, 110)">
                            <rect width="15" height="15" fill="#4CAF50"/>
                            <text x="22" y="12" font-size="10" fill="#333">Jest</text>
                        </g>
                        
                        <!-- Bottom text -->
                        <text x="300" y="280" text-anchor="middle" font-size="11" fill="#666">Fast ‚Üí Slow | Many ‚Üí Few | Cheap ‚Üí Expensive</text>
                    </svg>
                </div>

                <p>You're now equipped to write tests at every level, ensuring your React Native app is reliable, maintainable, and user-friendly!</p>
            </section>

            <!-- Lesson Navigation -->
            <div class="lesson-nav">
                <a href="m09_l04_integration_testing.html" class="prev-link">‚Üê Previous: Integration Testing</a>
                <a href="index.html" class="home-link">üè† Home</a>
                <a href="m10_l01_app_performance.html" class="next-link">Next: Module 10 - App Performance ‚Üí</a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 React Native & Expo Course. All rights reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/clipboard.js"></script>
    <script src="js/course-enhancements.js"></script>
</body>
</html>
