<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn end-to-end testing for React Native apps with Maestro">
    <meta name="author" content="React Native & Expo Course">
    <title>E2E Testing with Maestro | Module 9: Testing and Quality Assurance | React Native & Expo Course</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-main">Skip to main content</a>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="nav-logo">üì± RN Course</a>
            <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-expanded="false" aria-controls="nav-links">
                ‚ò∞
            </button>
            <div class="nav-links" id="nav-links">
                <a href="index.html">Home</a>
                <a href="index.html#modules">Modules</a>
                <a href="index.html#appendices">Appendices</a>
                <button id="theme-toggle" aria-label="Toggle theme">üåô</button>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <a href="index.html">Home</a> &gt;
            <a href="index.html#modules">Modules</a> &gt;
            <a href="m09_l01_testing_fundamentals.html">Module 9</a> &gt;
            <span>Lesson 9.5</span>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">
        <div class="container">
            <!-- Lesson Header -->
            <header>
                <p class="module-tag">Module 9: Testing and Quality Assurance</p>
                <h1>E2E Testing with Maestro</h1>
                <p class="lesson-subtitle">Automated UI testing on real devices and simulators</p>
            </header>

            <!-- Learning Objectives -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="color: white; border: none; margin-top: 0;">üéØ Learning Objectives</h2>
                <ul style="color: white;">
                    <li>Understand what E2E testing is and when to use it</li>
                    <li>Set up Maestro for React Native/Expo projects</li>
                    <li>Write Maestro flow files in YAML</li>
                    <li>Use selectors to find and interact with elements</li>
                    <li>Handle assertions and conditional logic</li>
                    <li>Test complex user flows and edge cases</li>
                    <li>Integrate E2E tests into CI/CD pipelines</li>
                </ul>
            </div>

            <!-- Table of Contents -->
            <div class="toc-container">
                <details class="toc-details" open>
                    <summary>üìë Table of Contents</summary>
                    <ul class="toc-list">
                        <li><a href="#e2e-overview">E2E Testing Overview</a></li>
                        <li><a href="#maestro-setup">Maestro Setup</a></li>
                        <li><a href="#writing-flows">Writing Flows</a></li>
                        <li><a href="#selectors">Selectors and Elements</a></li>
                        <li><a href="#interactions">Interactions</a></li>
                        <li><a href="#assertions">Assertions</a></li>
                        <li><a href="#advanced">Advanced Features</a></li>
                        <li><a href="#ci-cd">CI/CD Integration</a></li>
                        <li><a href="#exercises">Hands-On Exercises</a></li>
                        <li><a href="#summary">Summary</a></li>
                    </ul>
                </details>
            </div>

            <!-- E2E Testing Overview -->
            <section id="e2e-overview">
                <h2>E2E Testing Overview</h2>

                <p>End-to-end (E2E) tests verify your entire application works correctly from the user's perspective, testing real interactions on actual devices or simulators.</p>

                <h3>What is E2E Testing?</h3>

                <!-- SVG: E2E Testing Flow -->
                <div class="svg-container" style="text-align: center; margin: 2rem 0;">
                    <svg viewBox="0 0 700 200" style="max-width: 700px; height: auto; font-family: system-ui, sans-serif;">
                        <!-- Background -->
                        <rect width="700" height="200" fill="#f8f9fa"/>
                        
                        <!-- User -->
                        <g transform="translate(50, 60)">
                            <circle cx="30" cy="20" r="20" fill="#667eea"/>
                            <rect x="10" y="45" width="40" height="50" rx="5" fill="#667eea"/>
                            <text x="30" y="120" text-anchor="middle" font-size="11" fill="#333">User</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 110 90 L 150 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- App UI -->
                        <g transform="translate(160, 40)">
                            <rect width="100" height="120" fill="#4CAF50" rx="10"/>
                            <rect x="10" y="10" width="80" height="15" fill="white" rx="3"/>
                            <rect x="10" y="35" width="80" height="40" fill="rgba(255,255,255,0.5)" rx="3"/>
                            <rect x="10" y="85" width="80" height="25" fill="white" rx="3"/>
                            <text x="50" y="175" text-anchor="middle" font-size="11" fill="#333">App UI</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 270 90 L 310 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Business Logic -->
                        <g transform="translate(320, 50)">
                            <rect width="100" height="100" fill="#2196F3" rx="10"/>
                            <text x="50" y="40" text-anchor="middle" font-size="10" fill="white">Business</text>
                            <text x="50" y="55" text-anchor="middle" font-size="10" fill="white">Logic</text>
                            <rect x="15" y="65" width="70" height="25" fill="rgba(255,255,255,0.3)" rx="3"/>
                            <text x="50" y="165" text-anchor="middle" font-size="11" fill="#333">Logic</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 430 90 L 470 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- API/Backend -->
                        <g transform="translate(480, 50)">
                            <rect width="100" height="100" fill="#FF9800" rx="10"/>
                            <text x="50" y="40" text-anchor="middle" font-size="10" fill="white">API /</text>
                            <text x="50" y="55" text-anchor="middle" font-size="10" fill="white">Backend</text>
                            <circle cx="50" cy="75" r="15" fill="rgba(255,255,255,0.3)"/>
                            <text x="50" y="165" text-anchor="middle" font-size="11" fill="#333">Backend</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 590 90 L 630 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Database -->
                        <g transform="translate(640, 55)">
                            <ellipse cx="25" cy="10" rx="25" ry="10" fill="#9C27B0"/>
                            <rect x="0" y="10" width="50" height="60" fill="#9C27B0"/>
                            <ellipse cx="25" cy="70" rx="25" ry="10" fill="#7B1FA2"/>
                            <text x="25" y="140" text-anchor="middle" font-size="11" fill="#333">DB</text>
                        </g>
                        
                        <!-- E2E Test bracket -->
                        <path d="M 40 180 L 40 175 L 680 175 L 680 180" stroke="#e91e63" stroke-width="2" fill="none"/>
                        <text x="360" y="195" text-anchor="middle" font-size="12" font-weight="bold" fill="#e91e63">E2E Test Coverage</text>
                        
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                            </marker>
                        </defs>
                    </svg>
                </div>

                <h3>When to Use E2E Tests</h3>

                <div class="card">
                    <h4>‚úÖ Use E2E Tests For</h4>
                    <ul>
                        <li><strong>Critical user flows:</strong> Login, checkout, onboarding</li>
                        <li><strong>Cross-feature interactions:</strong> Flows spanning multiple screens</li>
                        <li><strong>Regression testing:</strong> Ensure existing features still work</li>
                        <li><strong>Real device testing:</strong> Platform-specific behaviors</li>
                        <li><strong>Visual validation:</strong> Screenshots and visual comparisons</li>
                    </ul>
                    
                    <h4 style="margin-top: 16px;">‚ùå Avoid E2E Tests For</h4>
                    <ul>
                        <li>Testing implementation details</li>
                        <li>Exhaustive edge case coverage</li>
                        <li>Rapid iteration during development</li>
                        <li>Testing isolated components</li>
                    </ul>
                </div>

                <h3>Why Maestro?</h3>

                <p>Maestro is a mobile UI testing framework that offers several advantages:</p>

                <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Feature</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Benefit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">YAML-based flows</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Easy to write and maintain, no programming required</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Built-in tolerance</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Automatic retries and waiting for elements</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Cross-platform</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Same flows work on iOS and Android</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Maestro Studio</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Visual tool for discovering selectors</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Cloud support</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Run tests on Maestro Cloud in CI/CD</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Maestro Setup -->
            <section id="maestro-setup">
                <h2>Maestro Setup</h2>

                <h3>Installation</h3>

                <pre><code># macOS
curl -Ls "https://get.maestro.mobile.dev" | bash

# Windows (WSL2)
curl -Ls "https://get.maestro.mobile.dev" | bash

# Verify installation
maestro --version</code></pre>

                <h3>Project Setup</h3>

                <pre><code># Create maestro directory in your project
mkdir -p .maestro

# Project structure
your-app/
‚îú‚îÄ‚îÄ .maestro/
‚îÇ   ‚îú‚îÄ‚îÄ flows/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkout.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ onboarding.yaml
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ src/
‚îî‚îÄ‚îÄ package.json</code></pre>

                <h3>Adding testID to Components</h3>

                <p>For reliable element selection, add testID props to your components:</p>

                <pre><code>// Add testID to interactive elements
&lt;Pressable testID="login-button" onPress={handleLogin}&gt;
  &lt;Text&gt;Login&lt;/Text&gt;
&lt;/Pressable&gt;

&lt;TextInput
  testID="email-input"
  placeholder="Email"
  value={email}
  onChangeText={setEmail}
/&gt;

&lt;TextInput
  testID="password-input"
  placeholder="Password"
  secureTextEntry
  value={password}
  onChangeText={setPassword}
/&gt;

// Use consistent naming conventions
// Format: [component]-[action/type]
// Examples: login-button, email-input, user-avatar, cart-badge</code></pre>

                <h3>Running Your First Test</h3>

                <pre><code># Build and run your app
npx expo start

# In a separate terminal, run Maestro Studio to explore your app
maestro studio

# Run a specific flow
maestro test .maestro/flows/login.yaml

# Run all flows
maestro test .maestro/flows/</code></pre>
            </section>

            <!-- Writing Flows -->
            <section id="writing-flows">
                <h2>Writing Flows</h2>

                <p>Maestro flows are written in YAML, describing user actions step by step.</p>

                <h3>Basic Flow Structure</h3>

                <pre><code># .maestro/flows/login.yaml
appId: com.yourcompany.yourapp  # Your app's bundle ID
---
# Flow steps
- launchApp

- tapOn:
    id: "email-input"

- inputText: "test@example.com"

- tapOn:
    id: "password-input"

- inputText: "password123"

- tapOn:
    id: "login-button"

- assertVisible:
    text: "Welcome"</code></pre>

                <h3>Flow Configuration</h3>

                <pre><code># .maestro/config.yaml
# Global configuration
flows:
  - flows/*.yaml

# Environment variables
env:
  TEST_EMAIL: "test@example.com"
  TEST_PASSWORD: "password123"
  API_URL: "https://api.staging.example.com"

# Execution settings
executionOrder:
  continueOnFailure: false
  flowsOrder:
    - flows/login.yaml
    - flows/home.yaml
    - flows/checkout.yaml</code></pre>

                <h3>Using Environment Variables</h3>

                <pre><code># .maestro/flows/login.yaml
appId: com.yourcompany.yourapp
---
- launchApp

- tapOn:
    id: "email-input"
- inputText: "${TEST_EMAIL}"

- tapOn:
    id: "password-input"  
- inputText: "${TEST_PASSWORD}"

- tapOn:
    id: "login-button"</code></pre>

                <pre><code># Run with custom env vars
maestro test --env TEST_EMAIL=custom@test.com .maestro/flows/login.yaml</code></pre>

                <h3>Flow with Comments</h3>

                <pre><code># .maestro/flows/checkout.yaml
appId: com.yourcompany.yourapp
name: "Checkout Flow"
tags:
  - critical
  - checkout
---
# Step 1: Start from home and add item to cart
- launchApp
- tapOn:
    id: "product-1"
- tapOn:
    id: "add-to-cart-button"

# Step 2: Go to cart
- tapOn:
    id: "cart-tab"
- assertVisible:
    id: "cart-item-1"

# Step 3: Proceed to checkout
- tapOn:
    id: "checkout-button"

# Step 4: Fill shipping info
- tapOn:
    id: "address-input"
- inputText: "123 Main Street"

# Step 5: Complete order
- tapOn:
    id: "place-order-button"

# Step 6: Verify success
- assertVisible:
    text: "Order Confirmed"</code></pre>
            </section>

            <!-- Selectors and Elements -->
            <section id="selectors">
                <h2>Selectors and Elements</h2>

                <p>Maestro provides multiple ways to find elements on screen.</p>

                <h3>Selector Types</h3>

                <pre><code># By testID (most reliable)
- tapOn:
    id: "login-button"

# By text content
- tapOn:
    text: "Login"

# By partial text (contains)
- tapOn:
    text: "Log.*"  # Regex pattern

# By accessibility label
- tapOn:
    accessibilityLabel: "Login button"

# Combining selectors
- tapOn:
    id: "submit-button"
    text: "Submit"  # Must match both</code></pre>

                <h3>Element Index</h3>

                <pre><code># When multiple elements match, use index
- tapOn:
    text: "Add"
    index: 0  # First "Add" button

- tapOn:
    text: "Add"
    index: 1  # Second "Add" button

# Or use more specific selectors
- tapOn:
    id: "add-button-product-1"</code></pre>

                <h3>Relative Selectors</h3>

                <pre><code># Find element relative to another
- tapOn:
    below:
      text: "Email"
    id: "text-input"

- tapOn:
    above:
      id: "footer"
    text: "Submit"

# Contained within
- tapOn:
    text: "Delete"
    containedIn:
      id: "cart-item-1"</code></pre>

                <h3>Using Maestro Studio</h3>

                <pre><code># Launch Maestro Studio to discover selectors
maestro studio

# Studio features:
# - Live view of your app
# - Click elements to see available selectors
# - Test commands interactively
# - Generate YAML snippets
# - View element hierarchy</code></pre>

                <div class="card" style="background: #e3f2fd; border-left: 4px solid #2196F3;">
                    <h4>üí° Selector Best Practices</h4>
                    <ul>
                        <li><strong>Prefer testID:</strong> Most stable, won't change with text/layout changes</li>
                        <li><strong>Use meaningful IDs:</strong> <code>submit-order-button</code> not <code>btn1</code></li>
                        <li><strong>Avoid index when possible:</strong> Tests break when order changes</li>
                        <li><strong>Fallback to text:</strong> When testID isn't available</li>
                    </ul>
                </div>
            </section>

            <!-- Interactions -->
            <section id="interactions">
                <h2>Interactions</h2>

                <p>Maestro supports various user interactions for comprehensive testing.</p>

                <h3>Tap Actions</h3>

                <pre><code># Simple tap
- tapOn:
    id: "button"

# Tap at coordinates (use sparingly)
- tapOn:
    point: "50%,50%"  # Center of screen

# Long press
- longPressOn:
    id: "list-item"

# Double tap
- doubleTapOn:
    id: "image"</code></pre>

                <h3>Text Input</h3>

                <pre><code># Type text into focused field
- inputText: "Hello World"

# Clear and type
- tapOn:
    id: "search-input"
- eraseText: 20  # Erase up to 20 characters
- inputText: "New search"

# Type with special keys
- inputText: "username"
- pressKey: Tab
- inputText: "password"
- pressKey: Enter

# Hide keyboard
- hideKeyboard</code></pre>

                <h3>Gestures</h3>

                <pre><code># Scroll
- scroll  # Default scroll down

- scrollUntilVisible:
    element:
      text: "Load More"
    direction: DOWN
    timeout: 10000

# Swipe
- swipe:
    direction: LEFT
    
- swipe:
    start: "90%,50%"
    end: "10%,50%"

# Pull to refresh
- scroll:
    direction: DOWN
    duration: 1000</code></pre>

                <h3>Navigation</h3>

                <pre><code># Go back (Android back button / iOS swipe)
- back

# Open URL / Deep link
- openLink: "yourapp://products/123"

# Launch app
- launchApp

# Launch with clear state
- launchApp:
    clearState: true

# Stop app
- stopApp

# Kill and relaunch
- stopApp
- launchApp</code></pre>

                <h3>Waiting</h3>

                <pre><code># Explicit wait
- waitForAnimationToEnd

# Wait for element with timeout
- assertVisible:
    id: "loading-complete"
    timeout: 10000  # 10 seconds

# Wait for element to disappear
- assertNotVisible:
    id: "loading-spinner"
    timeout: 5000

# Custom delay (use sparingly)
- wait: 2000  # 2 seconds</code></pre>
            </section>

            <!-- Assertions -->
            <section id="assertions">
                <h2>Assertions</h2>

                <p>Assertions verify that your app is in the expected state.</p>

                <h3>Visibility Assertions</h3>

                <pre><code># Element is visible
- assertVisible:
    id: "welcome-message"

- assertVisible:
    text: "Login successful"

# Element is NOT visible
- assertNotVisible:
    id: "error-message"

- assertNotVisible:
    text: "Error"

# With timeout
- assertVisible:
    id: "data-loaded"
    timeout: 15000</code></pre>

                <h3>Content Assertions</h3>

                <pre><code># Check text content
- assertVisible:
    text: "Hello, John"

# Regex matching
- assertVisible:
    text: "Order #[0-9]+"

# Check element contains text
- assertVisible:
    id: "price-display"
    text: "$99.99"</code></pre>

                <h3>State Assertions</h3>

                <pre><code># Check element is enabled
- assertVisible:
    id: "submit-button"
    enabled: true

# Check element is focused
- assertVisible:
    id: "email-input"
    focused: true

# Check checkbox/toggle state
- assertVisible:
    id: "terms-checkbox"
    checked: true</code></pre>

                <h3>Screenshot Assertions</h3>

                <pre><code># Take screenshot
- takeScreenshot: "checkout-complete"

# Screenshots saved to:
# ~/.maestro/tests/[timestamp]/screenshots/</code></pre>

                <h3>Conditional Logic</h3>

                <pre><code># Run steps only if element visible
- runFlow:
    when:
      visible:
        id: "onboarding-modal"
    commands:
      - tapOn:
          id: "skip-button"

# If-else pattern
- runFlow:
    when:
      visible:
        text: "Login"
    commands:
      - tapOn:
          id: "login-button"
      # ... login steps

- runFlow:
    when:
      notVisible:
        text: "Login"
    commands:
      # Already logged in, continue
      - assertVisible:
          id: "home-screen"</code></pre>
            </section>

            <!-- Advanced Features -->
            <section id="advanced">
                <h2>Advanced Features</h2>

                <h3>Subflows</h3>

                <pre><code># .maestro/flows/shared/login.yaml
appId: com.yourcompany.yourapp
---
- tapOn:
    id: "email-input"
- inputText: "${EMAIL}"

- tapOn:
    id: "password-input"
- inputText: "${PASSWORD}"

- tapOn:
    id: "login-button"

- assertVisible:
    id: "home-screen"

# .maestro/flows/purchase.yaml
appId: com.yourcompany.yourapp
env:
  EMAIL: "test@example.com"
  PASSWORD: "password123"
---
- launchApp:
    clearState: true

# Include login flow
- runFlow: shared/login.yaml

# Continue with purchase
- tapOn:
    id: "product-1"
- tapOn:
    id: "buy-now"</code></pre>

                <h3>Loops and Repeating</h3>

                <pre><code># Repeat action multiple times
- repeat:
    times: 3
    commands:
      - tapOn:
          id: "increment-button"

# Repeat until condition
- repeat:
    whileVisible:
      text: "Load More"
    commands:
      - tapOn:
          text: "Load More"
      - scroll

# Repeat with variable
- repeat:
    times: ${ITEM_COUNT}
    commands:
      - tapOn:
          text: "Add to Cart"
      - back</code></pre>

                <h3>External Scripts</h3>

                <pre><code># Run JavaScript for complex logic
- runScript:
    file: scripts/generate-data.js
    env:
      OUTPUT_VAR: generatedEmail

- tapOn:
    id: "email-input"
- inputText: "${generatedEmail}"

# scripts/generate-data.js
const timestamp = Date.now();
output.generatedEmail = `test-${timestamp}@example.com`;</code></pre>

                <h3>API Requests</h3>

                <pre><code># Make HTTP request during test
- evalScript: |
    const response = await http.get('https://api.example.com/test-token');
    output.token = response.body.token;

- tapOn:
    id: "token-input"
- inputText: "${token}"

# POST request
- evalScript: |
    const response = await http.post('https://api.example.com/reset', {
      body: JSON.stringify({ email: '${TEST_EMAIL}' }),
      headers: { 'Content-Type': 'application/json' }
    });
    output.resetCode = response.body.code;</code></pre>

                <h3>Handling Alerts and Permissions</h3>

                <pre><code># Handle system dialogs
- tapOn:
    text: "Allow"  # Permission dialog

# Dismiss alert
- tapOn:
    text: "OK"

# Handle specific iOS permissions
- tapOn:
    text: "Allow While Using App"

# On Android
- tapOn:
    text: "ALLOW"

# Conditional handling
- runFlow:
    when:
      visible:
        text: "Allow.*access"
    commands:
      - tapOn:
          text: "Allow"</code></pre>
            </section>
