<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn to implement push and local notifications in React Native with Expo">
    <meta name="author" content="React Native & Expo Course">
    <title>Notifications | Module 8: Native Features and Device APIs | React Native & Expo Course</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-main">Skip to main content</a>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="nav-logo">üì± RN Course</a>
            <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-expanded="false" aria-controls="nav-links">
                ‚ò∞
            </button>
            <div class="nav-links" id="nav-links">
                <a href="index.html">Home</a>
                <a href="index.html#modules">Modules</a>
                <a href="index.html#appendices">Appendices</a>
                <button id="theme-toggle" aria-label="Toggle theme">üåô</button>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <a href="index.html">Home</a> &gt;
            <a href="index.html#modules">Modules</a> &gt;
            <a href="m08_l01_permissions.html">Module 8</a> &gt;
            <span>Lesson 8.4</span>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content">
        <div class="container">
            <!-- Lesson Header -->
            <header>
                <p class="module-tag">Module 8: Native Features and Device APIs</p>
                <h1>Notifications</h1>
                <p class="lesson-subtitle">Push notifications, local notifications, and handling user interactions</p>
            </header>

            <!-- Learning Objectives -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="color: white; border: none; margin-top: 0;">üéØ Learning Objectives</h2>
                <ul style="color: white;">
                    <li>Understand the difference between push and local notifications</li>
                    <li>Request notification permissions properly</li>
                    <li>Get and use Expo push tokens</li>
                    <li>Schedule local notifications</li>
                    <li>Handle notifications when app is in foreground, background, or killed</li>
                    <li>Respond to notification interactions</li>
                    <li>Configure notification appearance and behavior</li>
                </ul>
            </div>

            <!-- Table of Contents -->
            <div class="toc-container">
                <details class="toc-details" open>
                    <summary>üìë Table of Contents</summary>
                    <ul class="toc-list">
                        <li><a href="#notification-types">Types of Notifications</a></li>
                        <li><a href="#setup">Setup and Permissions</a></li>
                        <li><a href="#push-tokens">Push Tokens</a></li>
                        <li><a href="#local-notifications">Local Notifications</a></li>
                        <li><a href="#scheduling">Scheduling Notifications</a></li>
                        <li><a href="#handling">Handling Notifications</a></li>
                        <li><a href="#customization">Customization</a></li>
                        <li><a href="#sending-push">Sending Push Notifications</a></li>
                        <li><a href="#exercises">Hands-On Exercises</a></li>
                        <li><a href="#summary">Summary</a></li>
                    </ul>
                </details>
            </div>

            <!-- Types of Notifications -->
            <section id="notification-types">
                <h2>Types of Notifications</h2>

                <p>Mobile notifications come in two flavors, each with different use cases and technical requirements.</p>

                <!-- SVG: Notification Types -->
                <div class="svg-container" style="text-align: center; margin: 2rem 0;">
                    <svg viewBox="0 0 700 320" style="max-width: 100%; height: auto; font-family: system-ui, sans-serif;">
                        <!-- Background -->
                        <rect width="700" height="320" fill="#f8f9fa"/>
                        
                        <!-- Title -->
                        <text x="350" y="25" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">Push vs Local Notifications</text>
                        
                        <!-- Push Notifications -->
                        <rect x="50" y="50" width="280" height="240" fill="#e3f2fd" stroke="#2196F3" stroke-width="2" rx="12"/>
                        <text x="190" y="80" text-anchor="middle" font-size="14" font-weight="bold" fill="#1976D2">Push Notifications</text>
                        
                        <!-- Push flow -->
                        <rect x="70" y="100" width="80" height="50" fill="#fff" stroke="#2196F3" rx="4"/>
                        <text x="110" y="130" text-anchor="middle" font-size="20">üñ•Ô∏è</text>
                        <text x="110" y="165" text-anchor="middle" font-size="9" fill="#666">Your Server</text>
                        
                        <path d="M150,125 L180,125" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowBlue)"/>
                        
                        <rect x="180" y="100" width="60" height="50" fill="#fff" stroke="#2196F3" rx="4"/>
                        <text x="210" y="130" text-anchor="middle" font-size="20">‚òÅÔ∏è</text>
                        <text x="210" y="165" text-anchor="middle" font-size="9" fill="#666">APNs/FCM</text>
                        
                        <path d="M240,125 L270,125" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowBlue)"/>
                        
                        <rect x="270" y="100" width="50" height="50" fill="#fff" stroke="#2196F3" rx="4"/>
                        <text x="295" y="130" text-anchor="middle" font-size="20">üì±</text>
                        <text x="295" y="165" text-anchor="middle" font-size="9" fill="#666">Device</text>
                        
                        <!-- Push use cases -->
                        <text x="70" y="195" font-size="10" fill="#333">‚úì New messages</text>
                        <text x="70" y="212" font-size="10" fill="#333">‚úì Social updates</text>
                        <text x="70" y="229" font-size="10" fill="#333">‚úì Breaking news</text>
                        <text x="70" y="246" font-size="10" fill="#333">‚úì Order updates</text>
                        <text x="70" y="263" font-size="10" fill="#333">‚úì Server-triggered alerts</text>
                        
                        <!-- Local Notifications -->
                        <rect x="370" y="50" width="280" height="240" fill="#e8f5e9" stroke="#4CAF50" stroke-width="2" rx="12"/>
                        <text x="510" y="80" text-anchor="middle" font-size="14" font-weight="bold" fill="#2e7d32">Local Notifications</text>
                        
                        <!-- Local flow -->
                        <rect x="450" y="100" width="120" height="50" fill="#fff" stroke="#4CAF50" rx="4"/>
                        <text x="510" y="125" text-anchor="middle" font-size="20">üì±</text>
                        <text x="510" y="145" text-anchor="middle" font-size="9" fill="#333">Device schedules locally</text>
                        <text x="510" y="165" text-anchor="middle" font-size="9" fill="#666">No server needed</text>
                        
                        <!-- Local use cases -->
                        <text x="390" y="195" font-size="10" fill="#333">‚úì Reminders</text>
                        <text x="390" y="212" font-size="10" fill="#333">‚úì Alarms</text>
                        <text x="390" y="229" font-size="10" fill="#333">‚úì Calendar events</text>
                        <text x="390" y="246" font-size="10" fill="#333">‚úì Timer completions</text>
                        <text x="390" y="263" font-size="10" fill="#333">‚úì Offline app alerts</text>
                        
                        <defs>
                            <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#2196F3"/>
                            </marker>
                        </defs>
                    </svg>
                </div>

                <div class="card">
                    <h4>üì± Notification Comparison</h4>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Aspect</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Push</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Local</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;"><strong>Origin</strong></td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Remote server</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Device itself</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;"><strong>Network</strong></td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Required</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Not required</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;"><strong>Timing</strong></td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Sent anytime by server</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Scheduled in advance</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;"><strong>Setup</strong></td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">APNs/FCM credentials needed</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">No credentials needed</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;"><strong>Works when killed</strong></td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Yes</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">Yes</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Setup and Permissions -->
            <section id="setup">
                <h2>Setup and Permissions</h2>

                <h3>Installation</h3>

                <pre><code># Install expo-notifications
npx expo install expo-notifications expo-device expo-constants</code></pre>

                <h3>Configuration</h3>

                <pre><code>// app.json
{
  "expo": {
    "plugins": [
      [
        "expo-notifications",
        {
          "icon": "./assets/notification-icon.png",
          "color": "#667eea",
          "sounds": ["./assets/notification-sound.wav"]
        }
      ]
    ],
    "android": {
      "useNextNotificationsApi": true
    }
  }
}</code></pre>

                <h3>Request Permission</h3>

                <pre><code>import * as Notifications from 'expo-notifications';
import * as Device from 'expo-device';
import { Platform } from 'react-native';

async function requestNotificationPermission(): Promise&lt;boolean&gt; {
  // Notifications don't work on simulators
  if (!Device.isDevice) {
    console.log('Must use physical device for notifications');
    return false;
  }

  // Check existing permission
  const { status: existingStatus } = await Notifications.getPermissionsAsync();
  
  let finalStatus = existingStatus;
  
  // Request if not already granted
  if (existingStatus !== 'granted') {
    const { status } = await Notifications.requestPermissionsAsync();
    finalStatus = status;
  }
  
  if (finalStatus !== 'granted') {
    console.log('Notification permission not granted');
    return false;
  }

  // Android requires a notification channel
  if (Platform.OS === 'android') {
    await Notifications.setNotificationChannelAsync('default', {
      name: 'Default',
      importance: Notifications.AndroidImportance.MAX,
      vibrationPattern: [0, 250, 250, 250],
      lightColor: '#667eea',
    });
  }

  return true;
}</code></pre>

                <h3>Android Notification Channels</h3>

                <p>Android 8+ requires notification channels for categorizing notifications:</p>

                <pre><code>import * as Notifications from 'expo-notifications';

// Create multiple channels for different notification types
async function setupNotificationChannels() {
  // Messages channel - high priority
  await Notifications.setNotificationChannelAsync('messages', {
    name: 'Messages',
    description: 'New message notifications',
    importance: Notifications.AndroidImportance.HIGH,
    sound: 'message.wav',
    vibrationPattern: [0, 250, 250, 250],
    lightColor: '#2196F3',
  });

  // Updates channel - default priority
  await Notifications.setNotificationChannelAsync('updates', {
    name: 'Updates',
    description: 'App updates and news',
    importance: Notifications.AndroidImportance.DEFAULT,
    sound: null,
  });

  // Reminders channel
  await Notifications.setNotificationChannelAsync('reminders', {
    name: 'Reminders',
    description: 'Scheduled reminders',
    importance: Notifications.AndroidImportance.HIGH,
    sound: 'reminder.wav',
  });
}

// List all channels
async function listChannels() {
  const channels = await Notifications.getNotificationChannelsAsync();
  console.log('Channels:', channels);
}

// Delete a channel
async function deleteChannel(channelId: string) {
  await Notifications.deleteNotificationChannelAsync(channelId);
}</code></pre>

                <div class="card" style="background-color: #fff3cd; border-left: 4px solid #ffc107;">
                    <h4>‚ö†Ô∏è Android Channel Importance</h4>
                    <ul>
                        <li><strong>MAX:</strong> Makes sound, shows heads-up notification</li>
                        <li><strong>HIGH:</strong> Makes sound, shows in status bar</li>
                        <li><strong>DEFAULT:</strong> Makes sound</li>
                        <li><strong>LOW:</strong> No sound</li>
                        <li><strong>MIN:</strong> No sound, doesn't appear in status bar</li>
                    </ul>
                </div>
            </section>

            <!-- Push Tokens -->
            <section id="push-tokens">
                <h2>Push Tokens</h2>

                <p>To send push notifications to a device, you need its unique push token. Expo provides a convenient way to get tokens that work with their push notification service.</p>

                <h3>Getting the Expo Push Token</h3>

                <pre><code>import * as Notifications from 'expo-notifications';
import Constants from 'expo-constants';
import * as Device from 'expo-device';
import { Platform } from 'react-native';

async function getExpoPushToken(): Promise&lt;string | null&gt; {
  // Must be a physical device
  if (!Device.isDevice) {
    console.log('Push notifications require a physical device');
    return null;
  }

  // Request permission first
  const { status } = await Notifications.getPermissionsAsync();
  if (status !== 'granted') {
    const { status: newStatus } = await Notifications.requestPermissionsAsync();
    if (newStatus !== 'granted') {
      return null;
    }
  }

  // Get the token
  try {
    const projectId = Constants.expoConfig?.extra?.eas?.projectId;
    
    const token = await Notifications.getExpoPushTokenAsync({
      projectId,
    });
    
    console.log('Expo Push Token:', token.data);
    return token.data;
    // Returns something like: "ExponentPushToken[xxxxxxxxxxxxxx]"
  } catch (error) {
    console.error('Error getting push token:', error);
    return null;
  }
}</code></pre>

                <h3>Saving Token to Your Server</h3>

                <pre><code>interface DeviceInfo {
  token: string;
  platform: 'ios' | 'android';
  userId?: string;
}

async function registerDeviceForNotifications(userId: string) {
  const token = await getExpoPushToken();
  
  if (!token) {
    console.log('Could not get push token');
    return;
  }

  const deviceInfo: DeviceInfo = {
    token,
    platform: Platform.OS as 'ios' | 'android',
    userId,
  };

  // Send to your backend
  try {
    await fetch('https://your-api.com/register-device', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(deviceInfo),
    });
    
    console.log('Device registered for notifications');
  } catch (error) {
    console.error('Failed to register device:', error);
  }
}</code></pre>

                <h3>Token Refresh Handling</h3>

                <pre><code>import { useEffect } from 'react';
import * as Notifications from 'expo-notifications';

function useNotificationToken(onTokenReceived: (token: string) => void) {
  useEffect(() => {
    // Get initial token
    getExpoPushToken().then(token => {
      if (token) onTokenReceived(token);
    });

    // Listen for token changes (rare, but possible)
    const subscription = Notifications.addPushTokenListener(({ data }) => {
      onTokenReceived(data);
    });

    return () => subscription.remove();
  }, [onTokenReceived]);
}</code></pre>

                <!-- Mermaid: Push Token Flow -->
                <pre class="mermaid">
sequenceDiagram
    participant App
    participant Expo
    participant APNs/FCM
    participant Server
    
    App->>Expo: Request push token
    Expo->>APNs/FCM: Register device
    APNs/FCM-->>Expo: Device token
    Expo-->>App: Expo Push Token
    App->>Server: Save token with userId
    Server-->>App: Token saved
    
    Note over Server: Later, when sending notification
    Server->>Expo: Send to push token
    Expo->>APNs/FCM: Forward notification
    APNs/FCM->>App: Deliver notification
                </pre>
            </section>

            <!-- Local Notifications -->
            <section id="local-notifications">
                <h2>Local Notifications</h2>

                <p>Local notifications are scheduled directly on the device without needing a server. They're perfect for reminders, alarms, and timer completions.</p>

                <h3>Send Immediate Notification</h3>

                <pre><code>import * as Notifications from 'expo-notifications';

async function sendLocalNotification() {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Hello! üëã',
      body: 'This is a local notification',
      data: { screen: 'home', id: '123' },
    },
    trigger: null, // null = send immediately
  });
}

// With more options
async function sendRichNotification() {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'New Message',
      subtitle: 'From John Doe',
      body: 'Hey, are you free for lunch today?',
      data: { 
        type: 'message',
        senderId: 'user-123',
        conversationId: 'conv-456',
      },
      sound: 'default',
      badge: 1,
      // iOS specific
      launchImageName: 'notification-image',
      // Android specific  
      color: '#667eea',
      priority: Notifications.AndroidNotificationPriority.HIGH,
    },
    trigger: null,
  });
}</code></pre>

                <h3>Notification Content Options</h3>

                <div class="card">
                    <h4>üìã Content Properties</h4>
                    <pre><code>const content = {
  // Required
  title: 'Notification Title',
  body: 'Notification body text',
  
  // Optional
  subtitle: 'Subtitle (iOS)',
  data: { any: 'data' },    // Custom data for handling
  sound: 'default',         // or custom sound file
  badge: 1,                 // App badge count
  
  // iOS specific
  launchImageName: 'image',
  attachments: [{ url: 'file://...' }],
  categoryIdentifier: 'category-id',
  
  // Android specific
  color: '#667eea',
  priority: AndroidNotificationPriority.HIGH,
  vibrationPattern: [0, 250, 250, 250],
  autoDismiss: true,
  sticky: false,
};</code></pre>
                </div>
            </section>

            <!-- Scheduling Notifications -->
            <section id="scheduling">
                <h2>Scheduling Notifications</h2>

                <p>Notifications can be scheduled for future delivery using various trigger types.</p>

                <h3>Time-Based Trigger</h3>

                <pre><code>import * as Notifications from 'expo-notifications';

// Schedule for X seconds from now
async function scheduleInSeconds(seconds: number) {
  const id = await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Reminder',
      body: `${seconds} seconds have passed!`,
    },
    trigger: {
      seconds,
      repeats: false,
    },
  });
  
  return id; // Save this to cancel later
}

// Schedule for a specific date/time
async function scheduleForDate(date: Date) {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Scheduled Event',
      body: 'Your event is starting now',
    },
    trigger: date,
  });
}

// Schedule for tomorrow at 9 AM
async function scheduleForTomorrow9AM() {
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  tomorrow.setHours(9, 0, 0, 0);
  
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Good Morning! ‚òÄÔ∏è',
      body: 'Time to start your day',
    },
    trigger: tomorrow,
  });
}</code></pre>

                <h3>Repeating Notifications</h3>

                <pre><code>// Daily at specific time
async function scheduleDailyReminder(hour: number, minute: number) {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Daily Reminder',
      body: 'Don\'t forget to check in!',
    },
    trigger: {
      hour,
      minute,
      repeats: true,
    },
  });
}

// Weekly on specific day
async function scheduleWeeklyReminder(weekday: number, hour: number, minute: number) {
  // weekday: 1 = Sunday, 2 = Monday, etc.
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Weekly Reminder',
      body: 'Time for your weekly review',
    },
    trigger: {
      weekday,
      hour,
      minute,
      repeats: true,
    },
  });
}

// Every X seconds (for testing)
async function scheduleRepeatingEvery(seconds: number) {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Repeating',
      body: 'This repeats every ' + seconds + ' seconds',
    },
    trigger: {
      seconds,
      repeats: true,
    },
  });
}</code></pre>

                <h3>Calendar Trigger (Cron-like)</h3>

                <pre><code>// More specific scheduling
async function scheduleMonthlyReminder() {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Monthly Bill Reminder',
      body: 'Your subscription renews tomorrow',
    },
    trigger: {
      day: 1,        // 1st of month
      hour: 10,
      minute: 0,
      repeats: true,
    },
  });
}

// Specific date components
async function scheduleYearlyBirthday(month: number, day: number) {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'üéÇ Birthday Reminder',
      body: 'Someone special has a birthday today!',
    },
    trigger: {
      month,  // 1-12
      day,    // 1-31
      hour: 9,
      minute: 0,
      repeats: true,
    },
  });
}</code></pre>

                <h3>Managing Scheduled Notifications</h3>

                <pre><code>// Get all scheduled notifications
async function getScheduledNotifications() {
  const scheduled = await Notifications.getAllScheduledNotificationsAsync();
  console.log('Scheduled:', scheduled);
  return scheduled;
}

// Cancel a specific notification
async function cancelNotification(notificationId: string) {
  await Notifications.cancelScheduledNotificationAsync(notificationId);
}

// Cancel all scheduled notifications
async function cancelAllNotifications() {
  await Notifications.cancelAllScheduledNotificationsAsync();
}

// Example: Schedule with ability to cancel
async function scheduleReminder(title: string, body: string, triggerDate: Date) {
  const id = await Notifications.scheduleNotificationAsync({
    content: { title, body },
    trigger: triggerDate,
  });
  
  // Return ID so caller can cancel if needed
  return id;
}

// Cancel by ID
const reminderId = await scheduleReminder('Meeting', 'Team sync in 15 min', meetingDate);
// Later...
await cancelNotification(reminderId);</code></pre>
            </section>

            <!-- Handling Notifications -->
            <section id="handling">
                <h2>Handling Notifications</h2>

                <p>Your app needs to handle notifications in three scenarios: foreground, background, and when the user taps on a notification.</p>

                <h3>Configure Foreground Behavior</h3>

                <pre><code>import * as Notifications from 'expo-notifications';

// Set how notifications behave when app is in foreground
Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,    // Show notification alert
    shouldPlaySound: true,    // Play sound
    shouldSetBadge: true,     // Update app badge
  }),
});

// You can also make this dynamic
Notifications.setNotificationHandler({
  handleNotification: async (notification) => {
    // Get notification data
    const data = notification.request.content.data;
    
    // Example: Don't show if user is already viewing that screen
    if (data.screen === currentScreen) {
      return {
        shouldShowAlert: false,
        shouldPlaySound: false,
        shouldSetBadge: false,
      };
    }
    
    return {
      shouldShowAlert: true,
      shouldPlaySound: true,
      shouldSetBadge: true,
    };
  },
});</code></pre>

                <h3>Listen for Notifications</h3>

                <pre><code>import { useEffect, useRef } from 'react';
import * as Notifications from 'expo-notifications';
import { useNavigation } from '@react-navigation/native';

export function useNotificationListeners() {
  const navigation = useNavigation();
  const notificationListener = useRef&lt;Notifications.Subscription&gt;();
  const responseListener = useRef&lt;Notifications.Subscription&gt;();

  useEffect(() => {
    // Listener for when notification is received while app is foregrounded
    notificationListener.current = Notifications.addNotificationReceivedListener(
      (notification) => {
        console.log('Notification received:', notification);
        
        const { title, body, data } = notification.request.content;
        // You could update UI, show in-app alert, etc.
      }
    );

    // Listener for when user taps on notification
    responseListener.current = Notifications.addNotificationResponseReceivedListener(
      (response) => {
        console.log('Notification tapped:', response);
        
        const data = response.notification.request.content.data;
        
        // Navigate based on notification data
        if (data.screen) {
          navigation.navigate(data.screen as never, data.params as never);
        }
      }
    );

    // Cleanup
    return () => {
      if (notificationListener.current) {
        Notifications.removeNotificationSubscription(notificationListener.current);
      }
      if (responseListener.current) {
        Notifications.removeNotificationSubscription(responseListener.current);
      }
    };
  }, [navigation]);
}</code></pre>

                <h3>Handle App Launch from Notification</h3>

                <pre><code>import * as Notifications from 'expo-notifications';

// Check if app was opened from a notification
async function getInitialNotification() {
  // Get the notification that launched the app (if any)
  const response = await Notifications.getLastNotificationResponseAsync();
  
  if (response) {
    console.log('App opened from notification:', response);
    
    const data = response.notification.request.content.data;
    return data;
  }
  
  return null;
}

// Use in your app initialization
function App() {
  const navigation = useNavigation();

  useEffect(() => {
    getInitialNotification().then(data => {
      if (data?.screen) {
        // Navigate to the screen from notification
        navigation.navigate(data.screen, data.params);
      }
    });            <!-- Customization -->
            <section id="customization">
                <h2>Customization</h2>

                <p>Customize how your notifications look and behave on different platforms.</p>

                <h3>Custom Notification Icon (Android)</h3>

                <pre><code>// app.json - configure the notification icon
{
  "expo": {
    "plugins": [
      [
        "expo-notifications",
        {
          "icon": "./assets/notification-icon.png",
          "color": "#667eea"
        }
      ]
    ]
  }
}</code></pre>

                <div class="card" style="background: #e3f2fd; border-left: 4px solid #2196F3;">
                    <h4>üì± Android Icon Requirements</h4>
                    <ul>
                        <li>96x96 pixels (or provide multiple densities)</li>
                        <li>Must be white with transparent background</li>
                        <li>Android will colorize it with the <code>color</code> setting</li>
                        <li>PNG format recommended</li>
                    </ul>
                </div>

                <h3>Custom Sounds</h3>

                <pre><code>// app.json - register custom sounds
{
  "expo": {
    "plugins": [
      [
        "expo-notifications",
        {
          "sounds": [
            "./assets/sounds/message.wav",
            "./assets/sounds/alert.wav",
            "./assets/sounds/reminder.wav"
          ]
        }
      ]
    ]
  }
}

// Use custom sound in notification
await Notifications.scheduleNotificationAsync({
  content: {
    title: 'Custom Sound',
    body: 'This plays a custom sound!',
    sound: 'message.wav', // Just the filename
  },
  trigger: null,
});</code></pre>

                <h3>Notification Categories (iOS Actions)</h3>

                <pre><code>import * as Notifications from 'expo-notifications';

// Set up notification categories with actions
async function setupNotificationCategories() {
  await Notifications.setNotificationCategoryAsync('message', [
    {
      identifier: 'reply',
      buttonTitle: 'Reply',
      textInput: {
        submitButtonTitle: 'Send',
        placeholder: 'Type your reply...',
      },
    },
    {
      identifier: 'mark-read',
      buttonTitle: 'Mark as Read',
    },
    {
      identifier: 'delete',
      buttonTitle: 'Delete',
      options: {
        isDestructive: true,
      },
    },
  ]);

  await Notifications.setNotificationCategoryAsync('reminder', [
    {
      identifier: 'snooze',
      buttonTitle: 'Snooze 10 min',
    },
    {
      identifier: 'complete',
      buttonTitle: 'Done',
    },
  ]);
}

// Send notification with category
await Notifications.scheduleNotificationAsync({
  content: {
    title: 'New Message',
    body: 'Hey, what\'s up?',
    categoryIdentifier: 'message', // Uses the category actions
  },
  trigger: null,
});

// Handle action responses
Notifications.addNotificationResponseReceivedListener((response) => {
  const actionId = response.actionIdentifier;
  const userText = response.userText; // For text input actions
  
  switch (actionId) {
    case 'reply':
      console.log('User replied:', userText);
      // Send reply to server
      break;
    case 'mark-read':
      console.log('Marked as read');
      break;
    case 'snooze':
      // Reschedule notification
      break;
  }
});</code></pre>

                <h3>Badge Management</h3>

                <pre><code>import * as Notifications from 'expo-notifications';

// Set badge count
async function setBadgeCount(count: number) {
  await Notifications.setBadgeCountAsync(count);
}

// Get current badge count
async function getBadgeCount() {
  return await Notifications.getBadgeCountAsync();
}

// Clear badge
async function clearBadge() {
  await Notifications.setBadgeCountAsync(0);
}

// Increment badge
async function incrementBadge() {
  const current = await getBadgeCount();
  await setBadgeCount(current + 1);
}

// Common pattern: Clear badge when app becomes active
import { useEffect } from 'react';
import { AppState } from 'react-native';

function useClearBadgeOnFocus() {
  useEffect(() => {
    const subscription = AppState.addEventListener('change', (state) => {
      if (state === 'active') {
        clearBadge();
      }
    });

    return () => subscription.remove();
  }, []);
}</code></pre>

                <h3>Dismiss Notifications</h3>

                <pre><code>// Dismiss a specific notification from the notification center
async function dismissNotification(notificationId: string) {
  await Notifications.dismissNotificationAsync(notificationId);
}

// Dismiss all notifications
async function dismissAllNotifications() {
  await Notifications.dismissAllNotificationsAsync();
}

// Get presented notifications (in notification center)
async function getPresentedNotifications() {
  const notifications = await Notifications.getPresentedNotificationsAsync();
  return notifications;
}</code></pre>
            </section>

            <!-- Sending Push Notifications -->
            <section id="sending-push">
                <h2>Sending Push Notifications</h2>

                <p>To send push notifications, your server needs to make requests to Expo's push notification service (or directly to APNs/FCM for production apps).</p>

                <h3>Using Expo Push Service</h3>

                <p>Expo provides a free push notification service that simplifies sending to both iOS and Android:</p>

                <pre><code>// Server-side code (Node.js example)
const { Expo } = require('expo-server-sdk');

const expo = new Expo();

async function sendPushNotification(pushToken: string, title: string, body: string, data?: object) {
  // Check that the push token is valid
  if (!Expo.isExpoPushToken(pushToken)) {
    console.error('Invalid Expo push token:', pushToken);
    return;
  }

  const message = {
    to: pushToken,
    sound: 'default',
    title,
    body,
    data: data || {},
  };

  try {
    const chunks = expo.chunkPushNotifications([message]);
    
    for (const chunk of chunks) {
      const ticketChunk = await expo.sendPushNotificationsAsync(chunk);
      console.log('Ticket:', ticketChunk);
    }
  } catch (error) {
    console.error('Error sending notification:', error);
  }
}

// Send to multiple users
async function sendToMultipleUsers(tokens: string[], title: string, body: string) {
  const messages = tokens
    .filter(token => Expo.isExpoPushToken(token))
    .map(token => ({
      to: token,
      sound: 'default',
      title,
      body,
    }));

  const chunks = expo.chunkPushNotifications(messages);
  
  for (const chunk of chunks) {
    await expo.sendPushNotificationsAsync(chunk);
  }
}</code></pre>

                <h3>Direct HTTP Request</h3>

                <pre><code>// You can also send directly via HTTP
async function sendNotificationHTTP(pushToken: string, title: string, body: string) {
  const response = await fetch('https://exp.host/--/api/v2/push/send', {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      to: pushToken,
      sound: 'default',
      title,
      body,
      data: { someData: 'goes here' },
    }),
  });

  const result = await response.json();
  console.log('Push result:', result);
}</code></pre>

                <h3>Push Message Options</h3>

                <div class="card">
                    <h4>üì§ Push Message Properties</h4>
                    <pre><code>{
  // Required
  to: 'ExponentPushToken[xxx]',
  
  // Content
  title: 'Notification Title',
  body: 'Notification body text',
  data: { /* custom data */ },
  
  // Behavior
  sound: 'default',           // or null for silent
  badge: 1,                   // iOS badge count
  ttl: 3600,                  // Seconds until expiry
  expiration: 1234567890,     // Unix timestamp
  priority: 'high',           // 'default' | 'normal' | 'high'
  
  // Android specific
  channelId: 'default',
  
  // iOS specific
  subtitle: 'Subtitle',
  _displayInForeground: true,
}</code></pre>
                </div>

                <h3>Complete Notification Service</h3>

                <pre><code>// notification-service.ts - Complete client-side setup
import * as Notifications from 'expo-notifications';
import * as Device from 'expo-device';
import Constants from 'expo-constants';
import { Platform } from 'react-native';

// Configure foreground behavior
Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,
    shouldPlaySound: true,
    shouldSetBadge: true,
  }),
});

class NotificationService {
  private static instance: NotificationService;
  private notificationListener?: Notifications.Subscription;
  private responseListener?: Notifications.Subscription;

  static getInstance() {
    if (!this.instance) {
      this.instance = new NotificationService();
    }
    return this.instance;
  }

  async initialize(onNotificationReceived?: (notification: Notifications.Notification) => void,
                   onNotificationResponse?: (response: Notifications.NotificationResponse) => void) {
    // Request permissions
    const hasPermission = await this.requestPermission();
    if (!hasPermission) {
      console.log('Notification permission denied');
      return null;
    }

    // Get token
    const token = await this.getToken();

    // Set up listeners
    if (onNotificationReceived) {
      this.notificationListener = Notifications.addNotificationReceivedListener(onNotificationReceived);
    }

    if (onNotificationResponse) {
      this.responseListener = Notifications.addNotificationResponseReceivedListener(onNotificationResponse);
    }

    return token;
  }

  async requestPermission(): Promise&lt;boolean&gt; {
    if (!Device.isDevice) {
      return false;
    }

    const { status } = await Notifications.requestPermissionsAsync();
    
    if (Platform.OS === 'android') {
      await Notifications.setNotificationChannelAsync('default', {
        name: 'Default',
        importance: Notifications.AndroidImportance.MAX,
      });
    }

    return status === 'granted';
  }

  async getToken(): Promise&lt;string | null&gt; {
    if (!Device.isDevice) {
      return null;
    }

    try {
      const projectId = Constants.expoConfig?.extra?.eas?.projectId;
      const { data } = await Notifications.getExpoPushTokenAsync({ projectId });
      return data;
    } catch (error) {
      console.error('Error getting push token:', error);
      return null;
    }
  }

  async scheduleLocal(title: string, body: string, trigger: Notifications.NotificationTriggerInput, data?: object) {
    return await Notifications.scheduleNotificationAsync({
      content: { title, body, data: data || {} },
      trigger,
    });
  }

  async cancelAll() {
    await Notifications.cancelAllScheduledNotificationsAsync();
  }

  async clearBadge() {
    await Notifications.setBadgeCountAsync(0);
  }

  cleanup() {
    this.notificationListener?.remove();
    this.responseListener?.remove();
  }
}

export const notificationService = NotificationService.getInstance();

// Usage in App.tsx
import { useEffect } from 'react';
import { notificationService } from './notification-service';

function App() {
  useEffect(() => {
    notificationService.initialize(
      (notification) => {
        console.log('Received:', notification);
      },
      (response) => {
        console.log('Tapped:', response);
        // Handle navigation based on response.notification.request.content.data
      }
    );

    return () => notificationService.cleanup();
  }, []);

  return &lt;YourApp /&gt;;
}</code></pre>
            </section>

            <!-- Hands-On Exercises -->
            <section id="exercises">
                <h2>Hands-On Exercises</h2>

                <div class="exercise-card">
                    <h3>Exercise 1: Reminder App</h3>
                    <p>Build a simple reminder app that schedules local notifications.</p>
                    
                    <h4>Requirements:</h4>
                    <ul>
                        <li>Text input for reminder message</li>
                        <li>Date/time picker for when to remind</li>
                        <li>Schedule button that creates the notification</li>
                        <li>List of scheduled reminders with cancel option</li>
                    </ul>

                    <details>
                        <summary>Show Hint</summary>
                        <p>Use <code>Notifications.scheduleNotificationAsync</code> with a Date trigger. Store notification IDs in state to display the list. Use <code>Notifications.cancelScheduledNotificationAsync</code> to cancel individual reminders.</p>
                    </details>

                    <details>
                        <summary>Show Solution</summary>
                        <pre><code>import { useState, useEffect } from 'react';
import { View, Text, TextInput, Pressable, FlatList, StyleSheet, Alert } from 'react-native';
import DateTimePicker from '@react-native-community/datetimepicker';
import * as Notifications from 'expo-notifications';

interface Reminder {
  id: string;
  message: string;
  date: Date;
}

Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,
    shouldPlaySound: true,
    shouldSetBadge: false,
  }),
});

export default function ReminderApp() {
  const [message, setMessage] = useState('');
  const [date, setDate] = useState(new Date());
  const [showPicker, setShowPicker] = useState(false);
  const [reminders, setReminders] = useState&lt;Reminder[]&gt;([]);

  useEffect(() => {
    requestPermission();
    loadScheduledReminders();
  }, []);

  const requestPermission = async () => {
    const { status } = await Notifications.requestPermissionsAsync();
    if (status !== 'granted') {
      Alert.alert('Permission Required', 'Please enable notifications');
    }
  };

  const loadScheduledReminders = async () => {
    const scheduled = await Notifications.getAllScheduledNotificationsAsync();
    const loaded = scheduled.map(n => ({
      id: n.identifier,
      message: n.content.body || '',
      date: new Date(n.trigger?.value || Date.now()),
    }));
    setReminders(loaded);
  };

  const scheduleReminder = async () => {
    if (!message.trim()) {
      Alert.alert('Error', 'Please enter a reminder message');
      return;
    }

    if (date <= new Date()) {
      Alert.alert('Error', 'Please select a future date');
      return;
    }

    const id = await Notifications.scheduleNotificationAsync({
      content: {
        title: '‚è∞ Reminder',
        body: message,
        sound: 'default',
      },
      trigger: date,
    });

    setReminders(prev => [...prev, { id, message, date }]);
    setMessage('');
    setDate(new Date());
  };

  const cancelReminder = async (id: string) => {
    await Notifications.cancelScheduledNotificationAsync(id);
    setReminders(prev => prev.filter(r => r.id !== id));
  };

  const formatDate = (d: Date) => {
    return d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  };

  return (
    &lt;View style={styles.container}&gt;
      &lt;Text style={styles.title}&gt;‚è∞ Reminders&lt;/Text&gt;

      &lt;TextInput
        style={styles.input}
        placeholder="What do you want to remember?"
        value={message}
        onChangeText={setMessage}
      /&gt;

      &lt;Pressable style={styles.dateButton} onPress={() => setShowPicker(true)}&gt;
        &lt;Text style={styles.dateButtonText}&gt;üìÖ {formatDate(date)}&lt;/Text&gt;
      &lt;/Pressable&gt;

      {showPicker && (
        &lt;DateTimePicker
          value={date}
          mode="datetime"
          minimumDate={new Date()}
          onChange={(event, selectedDate) => {
            setShowPicker(false);
            if (selectedDate) setDate(selectedDate);
          }}
        /&gt;
      )}

      &lt;Pressable style={styles.scheduleButton} onPress={scheduleReminder}&gt;
        &lt;Text style={styles.scheduleButtonText}&gt;Schedule Reminder&lt;/Text&gt;
      &lt;/Pressable&gt;

      &lt;Text style={styles.listTitle}&gt;Upcoming Reminders&lt;/Text&gt;

      &lt;FlatList
        data={reminders.sort((a, b) => a.date.getTime() - b.date.getTime())}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          &lt;View style={styles.reminderItem}&gt;
            &lt;View style={styles.reminderInfo}&gt;
              &lt;Text style={styles.reminderMessage}&gt;{item.message}&lt;/Text&gt;
              &lt;Text style={styles.reminderDate}&gt;{formatDate(item.date)}&lt;/Text&gt;
            &lt;/View&gt;
            &lt;Pressable onPress={() => cancelReminder(item.id)}&gt;
              &lt;Text style={styles.cancelText}&gt;‚úï&lt;/Text&gt;
            &lt;/Pressable&gt;
          &lt;/View&gt;
        )}
        ListEmptyComponent={&lt;Text style={styles.emptyText}&gt;No reminders scheduled&lt;/Text&gt;}
      /&gt;
    &lt;/View&gt;
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20 },
  title: { fontSize: 28, fontWeight: 'bold', marginBottom: 20 },
  input: { backgroundColor: '#f5f5f5', padding: 16, borderRadius: 8, fontSize: 16, marginBottom: 12 },
  dateButton: { backgroundColor: '#e3f2fd', padding: 16, borderRadius: 8, marginBottom: 12 },
  dateButtonText: { fontSize: 16, textAlign: 'center' },
  scheduleButton: { backgroundColor: '#667eea', padding: 16, borderRadius: 8, marginBottom: 24 },
  scheduleButtonText: { color: 'white', fontSize: 16, fontWeight: '600', textAlign: 'center' },
  listTitle: { fontSize: 18, fontWeight: '600', marginBottom: 12 },
  reminderItem: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', backgroundColor: '#f5f5f5', padding: 16, borderRadius: 8, marginBottom: 8 },
  reminderInfo: { flex: 1 },
  reminderMessage: { fontSize: 16, fontWeight: '500' },
  reminderDate: { fontSize: 12, color: '#666', marginTop: 4 },
  cancelText: { fontSize: 20, color: '#f44336', padding: 8 },
  emptyText: { color: '#999', textAlign: 'center', marginTop: 20 },
});</code></pre>
                    </details>
                </div>

                <div class="exercise-card">
                    <h3>Exercise 2: Notification Tester</h3>
                    <p>Build a notification testing tool that demonstrates different notification types.</p>
                    
                    <h4>Requirements:</h4>
                    <ul>
                        <li>Button to send immediate notification</li>
                        <li>Button to send notification in 5 seconds</li>
                        <li>Button to send notification with custom data</li>
                        <li>Display received notification content</li>
                    </ul>

                    <details>
                        <summary>Show Hint</summary>
                        <p>Use <code>addNotificationReceivedListener</code> to capture incoming notifications. Display the notification content in state. Use <code>trigger: null</code> for immediate and <code>trigger: { seconds: 5 }</code> for delayed.</p>
                    </details>

                    <details>
                        <summary>Show Solution</summary>
                        <pre><code>import { useState, useEffect, useRef } from 'react';
import { View, Text, Pressable, ScrollView, StyleSheet } from 'react-native';
import * as Notifications from 'expo-notifications';

Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,
    shouldPlaySound: true,
    shouldSetBadge: true,
  }),
});

export default function NotificationTester() {
  const [lastNotification, setLastNotification] = useState&lt;Notifications.Notification | null&gt;(null);
  const [lastResponse, setLastResponse] = useState&lt;Notifications.NotificationResponse | null&gt;(null);
  const notificationListener = useRef&lt;Notifications.Subscription&gt;();
  const responseListener = useRef&lt;Notifications.Subscription&gt;();

  useEffect(() => {
    Notifications.requestPermissionsAsync();

    notificationListener.current = Notifications.addNotificationReceivedListener(
      notification => setLastNotification(notification)
    );

    responseListener.current = Notifications.addNotificationResponseReceivedListener(
      response => setLastResponse(response)
    );

    return () => {
      notificationListener.current?.remove();
      responseListener.current?.remove();
    };
  }, []);

  const sendImmediate = async () => {
    await Notifications.scheduleNotificationAsync({
      content: {
        title: 'üîî Immediate Notification',
        body: 'This was sent right away!',
        data: { type: 'immediate', timestamp: Date.now() },
      },
      trigger: null,
    });
  };

  const sendDelayed = async () => {
    await Notifications.scheduleNotificationAsync({
      content: {
        title: '‚è∞ Delayed Notification',
        body: 'This was sent after 5 seconds',
        data: { type: 'delayed', timestamp: Date.now() },
      },
      trigger: { seconds: 5 },
    });
  };

  const sendWithData = async () => {
    await Notifications.scheduleNotificationAsync({
      content: {
        title: 'üì¶ Data Notification',
        body: 'This notification includes custom data',
        data: {
          type: 'custom',
          screen: 'profile',
          userId: 'user-123',
          metadata: { score: 100, level: 5 },
        },
      },
      trigger: null,
    });
  };

  return (
    &lt;ScrollView style={styles.container}&gt;
      &lt;Text style={styles.title}&gt;üß™ Notification Tester&lt;/Text&gt;

      &lt;View style={styles.buttonGroup}&gt;
        &lt;Pressable style={styles.button} onPress={sendImmediate}&gt;
          &lt;Text style={styles.buttonText}&gt;Send Immediate&lt;/Text&gt;
        &lt;/Pressable&gt;

        &lt;Pressable style={[styles.button, styles.delayedButton]} onPress={sendDelayed}&gt;
          &lt;Text style={styles.buttonText}&gt;Send in 5 sec&lt;/Text&gt;
        &lt;/Pressable&gt;

        &lt;Pressable style={[styles.button, styles.dataButton]} onPress={sendWithData}&gt;
          &lt;Text style={styles.buttonText}&gt;Send with Data&lt;/Text&gt;
        &lt;/Pressable&gt;
      &lt;/View&gt;

      &lt;Text style={styles.sectionTitle}&gt;Last Received Notification&lt;/Text&gt;
      {lastNotification ? (
        &lt;View style={styles.card}&gt;
          &lt;Text style={styles.cardTitle}&gt;{lastNotification.request.content.title}&lt;/Text&gt;
          &lt;Text style={styles.cardBody}&gt;{lastNotification.request.content.body}&lt;/Text&gt;
          &lt;Text style={styles.cardData}&gt;
            Data: {JSON.stringify(lastNotification.request.content.data, null, 2)}
          &lt;/Text&gt;
        &lt;/View&gt;
      ) : (
        &lt;Text style={styles.emptyText}&gt;No notifications received yet&lt;/Text&gt;
      )}

      &lt;Text style={styles.sectionTitle}&gt;Last Tapped Notification&lt;/Text&gt;
      {lastResponse ? (
        &lt;View style={styles.card}&gt;
          &lt;Text style={styles.cardTitle}&gt;{lastResponse.notification.request.content.title}&lt;/Text&gt;
          &lt;Text style={styles.cardData}&gt;
            Action: {lastResponse.actionIdentifier}
          &lt;/Text&gt;
          &lt;Text style={styles.cardData}&gt;
            Data: {JSON.stringify(lastResponse.notification.request.content.data, null, 2)}
          &lt;/Text&gt;
        &lt;/View&gt;
      ) : (
        &lt;Text style={styles.emptyText}&gt;No notifications tapped yet&lt;/Text&gt;
      )}
    &lt;/ScrollView&gt;
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20 },
  title: { fontSize: 28, fontWeight: 'bold', marginBottom: 24 },
  buttonGroup: { marginBottom: 32 },
  button: { backgroundColor: '#667eea', padding: 16, borderRadius: 8, marginBottom: 12 },
  delayedButton: { backgroundColor: '#FF9800' },
  dataButton: { backgroundColor: '#4CAF50' },
  buttonText: { color: 'white', fontSize: 16, fontWeight: '600', textAlign: 'center' },
  sectionTitle: { fontSize: 18, fontWeight: '600', marginBottom: 12 },
  card: { backgroundColor: '#f5f5f5', padding: 16, borderRadius: 8, marginBottom: 24 },
  cardTitle: { fontSize: 16, fontWeight: '600', marginBottom: 8 },
  cardBody: { fontSize: 14, marginBottom: 8 },
  cardData: { fontSize: 12, color: '#666', fontFamily: 'monospace' },
  emptyText: { color: '#999', fontStyle: 'italic', marginBottom: 24 },
});</code></pre>
                    </details>
                </div>

                <div class="exercise-card">
                    <h3>Exercise 3: Daily Streak Reminder</h3>
                    <p>Build a daily streak app that reminds users to check in each day.</p>
                    
                    <h4>Requirements:</h4>
                    <ul>
                        <li>Display current streak count</li>
                        <li>Check-in button that increments streak</li>
                        <li>Toggle to enable/disable daily reminder</li>
                        <li>Time picker for when to send the reminder</li>
                        <li>Reminder should repeat daily at chosen time</li>
                    </ul>

                    <details>
                        <summary>Show Hint</summary>
                        <p>Use <code>trigger: { hour, minute, repeats: true }</code> for daily repeating notifications. Store streak count and reminder settings in AsyncStorage. Cancel and reschedule when time changes.</p>
                    </details>

                    <details>
                        <summary>Show Solution</summary>
                        <pre><code>import { useState, useEffect } from 'react';
import { View, Text, Pressable, Switch, StyleSheet } from 'react-native';
import DateTimePicker from '@react-native-community/datetimepicker';
import AsyncStorage from '@react-native-async-storage/async-storage';
import * as Notifications from 'expo-notifications';

const STREAK_KEY = 'streak';
const LAST_CHECKIN_KEY = 'lastCheckin';
const REMINDER_ID_KEY = 'reminderId';

Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,
    shouldPlaySound: true,
    shouldSetBadge: true,
  }),
});

export default function StreakReminder() {
  const [streak, setStreak] = useState(0);
  const [checkedInToday, setCheckedInToday] = useState(false);
  const [reminderEnabled, setReminderEnabled] = useState(false);
  const [reminderTime, setReminderTime] = useState(new Date());
  const [showTimePicker, setShowTimePicker] = useState(false);

  useEffect(() => {
    loadData();
    Notifications.requestPermissionsAsync();
  }, []);

  const loadData = async () => {
    const savedStreak = await AsyncStorage.getItem(STREAK_KEY);
    const lastCheckin = await AsyncStorage.getItem(LAST_CHECKIN_KEY);
    const reminderId = await AsyncStorage.getItem(REMINDER_ID_KEY);

    if (savedStreak) setStreak(parseInt(savedStreak));
    if (reminderId) setReminderEnabled(true);

    // Check if already checked in today
    if (lastCheckin) {
      const lastDate = new Date(lastCheckin).toDateString();
      const today = new Date().toDateString();
      setCheckedInToday(lastDate === today);

      // Reset streak if missed a day
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      if (lastDate !== today && lastDate !== yesterday.toDateString()) {
        setStreak(0);
        await AsyncStorage.setItem(STREAK_KEY, '0');
      }
    }
  };

  const handleCheckin = async () => {
    if (checkedInToday) return;

    const newStreak = streak + 1;
    setStreak(newStreak);
    setCheckedInToday(true);

    await AsyncStorage.setItem(STREAK_KEY, newStreak.toString());
    await AsyncStorage.setItem(LAST_CHECKIN_KEY, new Date().toISOString());
  };

  const toggleReminder = async (enabled: boolean) => {
    setReminderEnabled(enabled);

    if (enabled) {
      await scheduleReminder();
    } else {
      await cancelReminder();
    }
  };

  const scheduleReminder = async () => {
    await cancelReminder();

    const id = await Notifications.scheduleNotificationAsync({
      content: {
        title: 'üî• Don\'t break your streak!',
        body: `You have a ${streak} day streak. Check in to keep it going!`,
        sound: 'default',
      },
      trigger: {
        hour: reminderTime.getHours(),
        minute: reminderTime.getMinutes(),
        repeats: true,
      },
    });

    await AsyncStorage.setItem(REMINDER_ID_KEY, id);
  };

  const cancelReminder = async () => {
    const id = await AsyncStorage.getItem(REMINDER_ID_KEY);
    if (id) {
      await Notifications.cancelScheduledNotificationAsync(id);
      await AsyncStorage.removeItem(REMINDER_ID_KEY);
    }
  };

  const handleTimeChange = async (event: any, selectedTime?: Date) => {
    setShowTimePicker(false);
    if (selectedTime) {
      setReminderTime(selectedTime);
      if (reminderEnabled) {
        await scheduleReminder();
      }
    }
  };

  return (
    &lt;View style={styles.container}&gt;
      &lt;Text style={styles.streakNumber}&gt;{streak}&lt;/Text&gt;
      &lt;Text style={styles.streakLabel}&gt;Day Streak üî•&lt;/Text&gt;

      &lt;Pressable
        style={[styles.checkinButton, checkedInToday && styles.checkinButtonDone]}
        onPress={handleCheckin}
        disabled={checkedInToday}
      &gt;
        &lt;Text style={styles.checkinButtonText}&gt;
          {checkedInToday ? '‚úì Checked In Today' : 'Check In'}
        &lt;/Text&gt;
      &lt;/Pressable&gt;

      &lt;View style={styles.reminderSection}&gt;
        &lt;Text style={styles.sectionTitle}&gt;Daily Reminder&lt;/Text&gt;
        
        &lt;View style={styles.reminderRow}&gt;
          &lt;Text&gt;Enable Reminder&lt;/Text&gt;
          &lt;Switch value={reminderEnabled} onValueChange={toggleReminder} /&gt;
        &lt;/View&gt;

        {reminderEnabled && (
          &lt;Pressable style={styles.timeButton} onPress={() => setShowTimePicker(true)}&gt;
            &lt;Text&gt;Remind me at: {reminderTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}&lt;/Text&gt;
          &lt;/Pressable&gt;
        )}

        {showTimePicker && (
          &lt;DateTimePicker
            value={reminderTime}
            mode="time"
            onChange={handleTimeChange}
          /&gt;
        )}
      &lt;/View&gt;
    &lt;/View&gt;
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, alignItems: 'center', justifyContent: 'center' },
  streakNumber: { fontSize: 80, fontWeight: 'bold', color: '#667eea' },
  streakLabel: { fontSize: 24, color: '#666', marginBottom: 40 },
  checkinButton: { backgroundColor: '#4CAF50', paddingHorizontal: 48, paddingVertical: 16, borderRadius: 30 },
  checkinButtonDone: { backgroundColor: '#ccc' },
  checkinButtonText: { color: 'white', fontSize: 18, fontWeight: '600' },
  reminderSection: { marginTop: 60, width: '100%' },
  sectionTitle: { fontSize: 18, fontWeight: '600', marginBottom: 16 },
  reminderRow: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 },
  timeButton: { padding: 16, backgroundColor: '#f5f5f5', borderRadius: 8 },
});</code></pre>
                    </details>
                </div>
            </section>

            <!-- Summary -->
            <section id="summary">
                <h2>Summary</h2>

                <p>Notifications are a powerful way to keep users engaged with your app. Use them wisely‚Äîtoo many notifications drive users away, while well-timed, relevant notifications keep them coming back.</p>

                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h4 style="color: white;">üéØ Key Takeaways</h4>
                    <ul style="color: white;">
                        <li><strong>Push vs Local:</strong> Push comes from servers, local is scheduled on-device</li>
                        <li><strong>Permissions:</strong> Always request before sending notifications</li>
                        <li><strong>Expo Push Token:</strong> Unique identifier for sending push to a device</li>
                        <li><strong>Android Channels:</strong> Required for Android 8+, control notification behavior</li>
                        <li><strong>Triggers:</strong> Immediate (null), time-based (seconds), calendar (hour/minute)</li>
                        <li><strong>Foreground handler:</strong> Control if notifications show when app is open</li>
                        <li><strong>Response listener:</strong> Handle when user taps a notification</li>
                        <li><strong>Badge management:</strong> Keep badge count in sync with actual notifications</li>
                        <li><strong>Respect users:</strong> Let them control notification preferences</li>
                    </ul>
                </div>

                <p>In the next lesson, we'll explore device sensors‚Äîaccelerometer, gyroscope, and other motion sensors that enable unique interactive experiences.</p>
            </section>

            <!-- Lesson Navigation -->
            <div class="lesson-nav">
                <a href="m08_l03_location_services.html" class="prev-link">‚Üê Previous: Location Services</a>
                <a href="index.html" class="home-link">üè† Home</a>
                <a href="m08_l05_sensors_and_haptics.html" class="next-link">Next: Sensors and Haptics ‚Üí</a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 React Native & Expo Course. All rights reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/clipboard.js"></script>
    <script src="js/course-enhancements.js"></script>
</body>
</html>

  }, []);

  return &lt;YourApp /&gt;;
}</code></pre>

                <!-- Mermaid: Notification Handling States -->
                <pre class="mermaid">
stateDiagram-v2
    [*] --> Foreground: App is open
    [*] --> Background: App in background
    [*] --> Killed: App not running
    
    Foreground --> Received: Notification arrives
    Received --> Handler: handleNotification called
    Handler --> Display: Show/hide based on config
    
    Background --> SystemTray: Shows in notification center
    Killed --> SystemTray: Shows in notification center
    
    SystemTray --> UserTap: User taps notification
    UserTap --> AppLaunch: Opens/resumes app
    AppLaunch --> ResponseListener: Handles navigation
                </pre>
            </section>
